<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Uddy Olympic Cup</title>
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap" rel="stylesheet">
    
    <!-- React and Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Bebas Neue', sans-serif;
            overflow-x: hidden;
        }
        #root {
            width: 100%;
            min-height: 100vh;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createClient } = supabase;

        // Initialize Supabase client
        const supabaseClient = createClient(
            'https://jrtonswlzkusiwnvjkwf.supabase.co',
            'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImpydG9uc3dsemt1c2l3bnZqa3dmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5MzM4NjYsImV4cCI6MjA4NzUwOTg2Nn0.wrT2w_sn4HPvv-sVvOxarNTpMB3v9yw7vBXVGAyGqKg'
        );

        // Olympic Rings Icon
        const OlympicRingsIcon = () => (
            <svg width="60" height="40" viewBox="0 0 100 60">
                <circle cx="20" cy="20" r="12" fill="none" stroke="#0085C7" strokeWidth="3"/>
                <circle cx="50" cy="20" r="12" fill="none" stroke="#000000" strokeWidth="3"/>
                <circle cx="80" cy="20" r="12" fill="none" stroke="#EE334E" strokeWidth="3"/>
                <circle cx="35" cy="35" r="12" fill="none" stroke="#FCB131" strokeWidth="3"/>
                <circle cx="65" cy="35" r="12" fill="none" stroke="#00A651" strokeWidth="3"/>
            </svg>
        );

        // Lucide icons as inline SVGs
        const TrophyIcon = () => (
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2.5">
                <path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6" />
                <path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18" />
                <path d="M4 22h16" />
                <path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22" />
                <path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22" />
                <path d="M18 2H6v7a6 6 0 0 0 12 0V2Z" />
            </svg>
        );

        const CrownIcon = ({ size = 20, color = "#ffd700" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2">
                <path d="M2 4l3 12h14l3-12-6 7-4-7-4 7-6-7z"/>
            </svg>
        );

        // =============================================================================
        // MAIN APP
        // =============================================================================

        function TeamCompetition() {
            const [view, setView] = useState('login');
            const [currentUser, setCurrentUser] = useState(null);
            const [selectedEvent, setSelectedEvent] = useState(null);
            
            const [competition, setCompetition] = useState(null);
            const [teams, setTeams] = useState([]);
            const [players, setPlayers] = useState([]);
            const [events, setEvents] = useState([]);
            const [loading, setLoading] = useState(true);

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    const { data: compData } = await supabaseClient
                        .from('competition')
                        .select('*')
                        .single();
                    setCompetition(compData);

                    const { data: teamsData } = await supabaseClient
                        .from('teams')
                        .select('*')
                        .order('name');
                    setTeams(teamsData || []);

                    const { data: playersData } = await supabaseClient
                        .from('players')
                        .select('*')
                        .order('name');
                    setPlayers(playersData || []);

                    const { data: eventsData } = await supabaseClient
                        .from('events')
                        .select('*')
                        .order('created_at');
                    setEvents(eventsData || []);

                    setLoading(false);
                } catch (error) {
                    console.error('Error loading data:', error);
                    setLoading(false);
                }
            };

            useEffect(() => {
                const compChannel = supabaseClient
                    .channel('competition-changes')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'competition'
                    }, () => {
                        loadData();
                    })
                    .subscribe();

                const eventsChannel = supabaseClient
                    .channel('events-changes')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'events'
                    }, () => {
                        loadData();
                    })
                    .subscribe();

                return () => {
                    supabaseClient.removeChannel(compChannel);
                    supabaseClient.removeChannel(eventsChannel);
                };
            }, []);

            const handleLogin = (player) => {
                setCurrentUser(player);
                setView('scoreboard');
            };

            if (loading) {
                return (
                    <div style={{
                        minHeight: '100vh',
                        background: 'linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%)',
                        display: 'flex',
                        alignItems: 'center',
                        justifyContent: 'center',
                        color: '#ffffff',
                        fontSize: '2rem',
                    }}>
                        LOADING...
                    </div>
                );
            }

            return (
                <div style={{
                    minHeight: '100vh',
                    background: 'linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%)',
                    color: '#ffffff',
                }}>
                    <header style={{
                        background: 'rgba(0, 0, 0, 0.3)',
                        backdropFilter: 'blur(10px)',
                        borderBottom: '3px solid #ffd700',
                        padding: '1.5rem 2rem',
                        position: 'sticky',
                        top: 0,
                        zIndex: 100,
                    }}>
                        <div style={{ 
                            maxWidth: '1400px', 
                            margin: '0 auto', 
                            display: 'flex', 
                            alignItems: 'center', 
                            justifyContent: 'space-between' 
                        }}>
                            <div 
                                style={{ display: 'flex', alignItems: 'center', gap: '1rem', cursor: 'pointer' }} 
                                onClick={() => currentUser && setView('scoreboard')}
                            >
                                <OlympicRingsIcon />
                                <h1 style={{ 
                                    margin: 0, 
                                    fontSize: '2.5rem', 
                                    letterSpacing: '3px',
                                    background: 'linear-gradient(45deg, #ffd700, #ffed4e)',
                                    WebkitBackgroundClip: 'text',
                                    WebkitTextFillColor: 'transparent',
                                }}>
                                    UDDY OLYMPIC CUP
                                </h1>
                            </div>
                            {currentUser && (
                                <div style={{ 
                                    padding: '0.5rem 1rem',
                                    background: currentUser.is_admin ? 'rgba(255, 215, 0, 0.2)' : 'rgba(255, 255, 255, 0.1)',
                                    borderRadius: '20px',
                                    border: currentUser.is_admin ? '1px solid #ffd700' : '1px solid rgba(255, 255, 255, 0.3)',
                                    fontSize: '1rem',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '0.5rem',
                                }}>
                                    {currentUser.is_admin && <CrownIcon />}
                                    {currentUser.name}
                                </div>
                            )}
                        </div>
                    </header>

                    <main style={{ maxWidth: '1400px', margin: '0 auto', padding: '3rem 2rem' }}>
                        {view === 'login' && (
                            <LoginView players={players} teams={teams} onLogin={handleLogin} />
                        )}
                        {view === 'scoreboard' && (
                            <ScoreboardView 
                                competition={competition}
                                teams={teams}
                                players={players}
                                events={events}
                                currentUser={currentUser}
                                setView={setView}
                                setSelectedEvent={setSelectedEvent}
                                loadData={loadData}
                            />
                        )}
                        {view === 'event' && selectedEvent && (
                            <EventView
                                event={selectedEvent}
                                teams={teams}
                                players={players}
                                currentUser={currentUser}
                                setView={setView}
                                loadData={loadData}
                            />
                        )}
                    </main>
                </div>
            );
        }

        // =============================================================================
        // LOGIN VIEW
        // =============================================================================

        function LoginView({ players, teams, onLogin }) {
            const [showPasswordFor, setShowPasswordFor] = useState(null);
            const [password, setPassword] = useState('');
            const [error, setError] = useState('');
            
            const teamA = teams.find(t => t.name === 'Team A');
            const teamB = teams.find(t => t.name === 'Team B');
            const teamAPlayers = players.filter(p => p.team_id === teamA?.id);
            const teamBPlayers = players.filter(p => p.team_id === teamB?.id);

            const handlePlayerClick = async (player) => {
                // Chris and Thomas need to enter password
                if (player.name === 'Chris' || player.name === 'Thomas') {
                    setShowPasswordFor(player);
                    setPassword('');
                    setError('');
                } else {
                    // Other players can log in directly
                    onLogin(player);
                }
            };

            const handlePasswordSubmit = async (e) => {
                e.preventDefault();
                setError('');
                
                try {
                    // Try to sign in with Supabase Auth
                    // Email format: chris@uddyolympics.local or thomas@uddyolympics.local
                    const email = `${showPasswordFor.name.toLowerCase()}@uddyolympics.local`;
                    
                    const { data, error: signInError } = await supabaseClient.auth.signInWithPassword({
                        email: email,
                        password: password,
                    });
                    
                    if (signInError) {
                        setError('Incorrect password');
                        return;
                    }
                    
                    // Successfully logged in
                    onLogin(showPasswordFor);
                } catch (err) {
                    setError('Login failed');
                }
            };

            if (showPasswordFor) {
                return (
                    <div style={{ maxWidth: '500px', margin: '0 auto' }}>
                        <h2 style={{ 
                            fontSize: '3rem', 
                            marginBottom: '2rem',
                            letterSpacing: '4px',
                            textAlign: 'center',
                            color: '#ffd700',
                        }}>
                            ADMIN LOGIN
                        </h2>
                        
                        <div style={{
                            padding: '2rem',
                            background: 'rgba(255, 255, 255, 0.05)',
                            borderRadius: '12px',
                            border: '2px solid rgba(255, 255, 255, 0.1)',
                        }}>
                            <div style={{ 
                                fontSize: '1.5rem', 
                                marginBottom: '2rem',
                                textAlign: 'center',
                                color: '#ffffff',
                            }}>
                                {showPasswordFor.name}
                            </div>
                            
                            <form onSubmit={handlePasswordSubmit}>
                                <input
                                    type="password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    placeholder="Enter password"
                                    autoFocus
                                    style={{
                                        width: '100%',
                                        padding: '1rem',
                                        fontSize: '1.2rem',
                                        background: 'rgba(255, 255, 255, 0.1)',
                                        border: '2px solid rgba(255, 255, 255, 0.3)',
                                        borderRadius: '8px',
                                        color: '#ffffff',
                                        fontFamily: 'inherit',
                                        marginBottom: '1rem',
                                    }}
                                />
                                
                                {error && (
                                    <div style={{
                                        color: '#ff6b6b',
                                        marginBottom: '1rem',
                                        textAlign: 'center',
                                    }}>
                                        {error}
                                    </div>
                                )}
                                
                                <div style={{ display: 'flex', gap: '1rem' }}>
                                    <button
                                        type="button"
                                        onClick={() => setShowPasswordFor(null)}
                                        style={{
                                            flex: 1,
                                            padding: '1rem',
                                            background: 'rgba(255, 255, 255, 0.1)',
                                            border: '2px solid rgba(255, 255, 255, 0.3)',
                                            borderRadius: '8px',
                                            cursor: 'pointer',
                                            fontSize: '1.1rem',
                                            color: '#ffffff',
                                            fontFamily: 'inherit',
                                        }}
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        type="submit"
                                        style={{
                                            flex: 1,
                                            padding: '1rem',
                                            background: 'linear-gradient(135deg, #00ff00, #00cc00)',
                                            border: 'none',
                                            borderRadius: '8px',
                                            cursor: 'pointer',
                                            fontSize: '1.1rem',
                                            color: '#ffffff',
                                            fontFamily: 'inherit',
                                            fontWeight: 'bold',
                                        }}
                                    >
                                        Login
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                );
            }

            return (
                <div style={{ maxWidth: '900px', margin: '0 auto' }}>
                    <h2 style={{ 
                        fontSize: '3rem', 
                        marginBottom: '3rem',
                        letterSpacing: '4px',
                        textAlign: 'center',
                        color: '#ffd700',
                    }}>
                        SELECT YOUR NAME
                    </h2>
                    
                    <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '3rem' }}>
                        <div>
                            <h3 style={{ 
                                fontSize: '2rem', 
                                marginBottom: '2rem',
                                letterSpacing: '2px',
                                color: '#ff6b6b',
                                textAlign: 'center',
                            }}>
                                TEAM A
                            </h3>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {teamAPlayers.map(player => (
                                    <button
                                        key={player.id}
                                        onClick={() => handlePlayerClick(player)}
                                        style={{
                                            background: 'linear-gradient(135deg, rgba(255, 107, 107, 0.2), rgba(255, 107, 107, 0.1))',
                                            border: '2px solid rgba(255, 107, 107, 0.5)',
                                            borderRadius: '12px',
                                            padding: '1.5rem',
                                            cursor: 'pointer',
                                            fontSize: '1.5rem',
                                            color: '#ffffff',
                                            fontFamily: 'inherit',
                                            letterSpacing: '2px',
                                            transition: 'all 0.3s',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '0.5rem',
                                        }}
                                    >
                                        {player.name}
                                        {(player.name === 'Chris' || player.name === 'Thomas') && (
                                            <span style={{ fontSize: '0.8rem', opacity: 0.7 }}> üîê</span>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div>
                            <h3 style={{ 
                                fontSize: '2rem', 
                                marginBottom: '2rem',
                                letterSpacing: '2px',
                                color: '#4ecdc4',
                                textAlign: 'center',
                            }}>
                                TEAM B
                            </h3>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {teamBPlayers.map(player => (
                                    <button
                                        key={player.id}
                                        onClick={() => handlePlayerClick(player)}
                                        style={{
                                            background: 'linear-gradient(135deg, rgba(78, 205, 196, 0.2), rgba(78, 205, 196, 0.1))',
                                            border: '2px solid rgba(78, 205, 196, 0.5)',
                                            borderRadius: '12px',
                                            padding: '1.5rem',
                                            cursor: 'pointer',
                                            fontSize: '1.5rem',
                                            color: '#ffffff',
                                            fontFamily: 'inherit',
                                            letterSpacing: '2px',
                                            transition: 'all 0.3s',
                                            display: 'flex',
                                            alignItems: 'center',
                                            justifyContent: 'center',
                                            gap: '0.5rem',
                                        }}
                                    >
                                        {player.name}
                                        {(player.name === 'Chris' || player.name === 'Thomas') && (
                                            <span style={{ fontSize: '0.8rem', opacity: 0.7 }}> üîê</span>
                                        )}
                                    </button>
                                ))}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // =============================================================================
        // SCOREBOARD VIEW
        // =============================================================================

        function ScoreboardView({ competition, teams, players, events, currentUser, setView, setSelectedEvent, loadData }) {
            const canStartEvent = (event) => {
                if (event.name === 'Poker') {
                    // Poker can only start when all other events are complete
                    const otherEvents = events.filter(e => e.name !== 'Poker');
                    const allComplete = otherEvents.every(e => e.status === 'completed');
                    
                    if (!allComplete) {
                        return false;
                    }
                    
                    return event.status === 'not_started';
                }
                
                // Can't start if another event is DRAFTING (but in_progress is fine)
                const isDrafting = events.some(e => e.status === 'drafting');
                if (isDrafting && event.status === 'not_started') {
                    return false;
                }
                
                return event.status === 'not_started';
            };

            const [showTeamPicker, setShowTeamPicker] = useState(false);
            const [pendingEvent, setPendingEvent] = useState(null);

            const startEvent = async (event) => {
                if (!currentUser?.is_admin) return;
                
                // Only Chris can start events
                if (currentUser?.name !== 'Chris') {
                    alert('Only Chris can start events!');
                    return;
                }
                
                // Poker is special - no draft, just create tournament and go straight to in_progress
                if (event.name === 'Poker') {
                    await initializePokerTournament(event);
                    return;
                }
                
                // Show team picker modal for other events
                setPendingEvent(event);
                setShowTeamPicker(true);
            };

            const confirmStartEvent = async (firstTeam) => {
                setShowTeamPicker(false);
                
                if (!pendingEvent) return;
                
                await supabaseClient
                    .from('events')
                    .update({ 
                        status: 'drafting',
                        draft_team_turn: firstTeam,
                        current_draft_pick: 0
                    })
                    .eq('id', pendingEvent.id);
                
                // Reload the event to get updated data
                const { data: updatedEvent } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('id', pendingEvent.id)
                    .single();
                
                setSelectedEvent(updatedEvent);
                setView('event');
                await loadData();
                setPendingEvent(null);
            };

            const initializePokerTournament = async (event) => {
                console.log('Initializing poker tournament for event:', event.id);
                
                // First, clean up any existing tournaments for this event
                const { data: existingTournaments } = await supabaseClient
                    .from('poker_tournament')
                    .select('id')
                    .eq('event_id', event.id);

                if (existingTournaments && existingTournaments.length > 0) {
                    console.log('Found existing tournaments, deleting:', existingTournaments.length);
                    for (const oldTournament of existingTournaments) {
                        // Delete players
                        await supabaseClient
                            .from('poker_players')
                            .delete()
                            .eq('tournament_id', oldTournament.id);
                        
                        // Delete tables
                        await supabaseClient
                            .from('poker_tables')
                            .delete()
                            .eq('tournament_id', oldTournament.id);
                        
                        // Delete tournament
                        await supabaseClient
                            .from('poker_tournament')
                            .delete()
                            .eq('id', oldTournament.id);
                    }
                }

                // Create poker tournament record
                const { data: tournament, error: tournamentError } = await supabaseClient
                    .from('poker_tournament')
                    .insert({
                        event_id: event.id,
                        status: 'in_progress'
                    })
                    .select()
                    .single();

                if (tournamentError) {
                    console.error('Error creating tournament:', tournamentError);
                    alert('Error creating tournament. Please try again.');
                    return;
                }

                console.log('Created tournament:', tournament);

                // Create 2 tables
                const { data: tables, error: tablesError } = await supabaseClient
                    .from('poker_tables')
                    .insert([
                        { tournament_id: tournament.id, table_number: 1, is_active: true },
                        { tournament_id: tournament.id, table_number: 2, is_active: true }
                    ])
                    .select();

                if (tablesError) {
                    console.error('Error creating tables:', tablesError);
                    return;
                }

                console.log('Created tables:', tables);

                // Shuffle all 11 players randomly
                const allPlayers = [...players];
                for (let i = allPlayers.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [allPlayers[i], allPlayers[j]] = [allPlayers[j], allPlayers[i]];
                }

                // Table 1 gets first 5 players, Table 2 gets remaining 6
                const table1Players = allPlayers.slice(0, 5);
                const table2Players = allPlayers.slice(5, 11);

                // Insert poker players with seating positions
                const pokerPlayers = [];
                
                table1Players.forEach((player, index) => {
                    pokerPlayers.push({
                        tournament_id: tournament.id,
                        player_id: player.id,
                        table_id: tables[0].id,
                        position: index + 1,
                        is_eliminated: false,
                        position_points: 0,
                        knockout_points: 0,
                        total_points: 0
                    });
                });

                table2Players.forEach((player, index) => {
                    pokerPlayers.push({
                        tournament_id: tournament.id,
                        player_id: player.id,
                        table_id: tables[1].id,
                        position: index + 1,
                        is_eliminated: false,
                        position_points: 0,
                        knockout_points: 0,
                        total_points: 0
                    });
                });

                const { error: playersError } = await supabaseClient
                    .from('poker_players')
                    .insert(pokerPlayers);

                if (playersError) {
                    console.error('Error creating poker players:', playersError);
                    return;
                }

                console.log('Created poker players:', pokerPlayers.length);

                // Set event to in_progress
                await supabaseClient
                    .from('events')
                    .update({ status: 'in_progress' })
                    .eq('id', event.id);

                // Reload everything
                await loadData();
                
                // Get fresh event data
                const { data: freshEvent } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('id', event.id)
                    .single();
                
                setSelectedEvent(freshEvent);
                setView('event');
            };

            const viewEvent = (event) => {
                setSelectedEvent(event);
                setView('event');
            };

            return (
                <div>
                    {/* Team Picker Modal */}
                    {showTeamPicker && (
                        <div style={{
                            position: 'fixed',
                            top: 0,
                            left: 0,
                            right: 0,
                            bottom: 0,
                            background: 'rgba(0, 0, 0, 0.8)',
                            display: 'flex',
                            alignItems: 'center',
                            justifyContent: 'center',
                            zIndex: 1000,
                        }}>
                            <div style={{
                                background: 'linear-gradient(135deg, #0f0c29 0%, #302b63 50%, #24243e 100%)',
                                padding: '3rem',
                                borderRadius: '12px',
                                border: '3px solid #ffd700',
                                maxWidth: '600px',
                            }}>
                                <h3 style={{ 
                                    fontSize: '2rem', 
                                    marginBottom: '2rem',
                                    textAlign: 'center',
                                    color: '#ffd700',
                                    letterSpacing: '2px',
                                }}>
                                    WHICH TEAM PICKS FIRST?
                                </h3>
                                <div style={{ display: 'flex', gap: '2rem', justifyContent: 'center' }}>
                                    <button
                                        onClick={() => confirmStartEvent('team_a')}
                                        style={{
                                            background: 'linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(255, 107, 107, 0.2))',
                                            border: '3px solid #ff6b6b',
                                            borderRadius: '12px',
                                            padding: '2rem 3rem',
                                            cursor: 'pointer',
                                            fontSize: '2rem',
                                            color: '#ff6b6b',
                                            fontFamily: 'inherit',
                                            letterSpacing: '3px',
                                            fontWeight: 'bold',
                                            transition: 'all 0.3s',
                                        }}
                                        onMouseEnter={e => {
                                            e.currentTarget.style.transform = 'scale(1.05)';
                                            e.currentTarget.style.boxShadow = '0 10px 40px rgba(255, 107, 107, 0.5)';
                                        }}
                                        onMouseLeave={e => {
                                            e.currentTarget.style.transform = 'scale(1)';
                                            e.currentTarget.style.boxShadow = 'none';
                                        }}
                                    >
                                        TEAM A
                                    </button>
                                    <button
                                        onClick={() => confirmStartEvent('team_b')}
                                        style={{
                                            background: 'linear-gradient(135deg, rgba(78, 205, 196, 0.3), rgba(78, 205, 196, 0.2))',
                                            border: '3px solid #4ecdc4',
                                            borderRadius: '12px',
                                            padding: '2rem 3rem',
                                            cursor: 'pointer',
                                            fontSize: '2rem',
                                            color: '#4ecdc4',
                                            fontFamily: 'inherit',
                                            letterSpacing: '3px',
                                            fontWeight: 'bold',
                                            transition: 'all 0.3s',
                                        }}
                                        onMouseEnter={e => {
                                            e.currentTarget.style.transform = 'scale(1.05)';
                                            e.currentTarget.style.boxShadow = '0 10px 40px rgba(78, 205, 196, 0.5)';
                                        }}
                                        onMouseLeave={e => {
                                            e.currentTarget.style.transform = 'scale(1)';
                                            e.currentTarget.style.boxShadow = 'none';
                                        }}
                                    >
                                        TEAM B
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Main Scoreboard */}
                    <div style={{ 
                        marginBottom: '4rem',
                        background: 'rgba(255, 255, 255, 0.05)',
                        padding: '3rem',
                        borderRadius: '12px',
                        border: '2px solid rgba(255, 255, 255, 0.1)',
                    }}>
                        <h2 style={{ 
                            fontSize: '3rem', 
                            marginBottom: '3rem',
                            letterSpacing: '4px',
                            textAlign: 'center',
                            color: '#ffd700',
                        }}>
                            LIVE SCOREBOARD
                        </h2>
                        
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '3rem', alignItems: 'center' }}>
                            <div style={{ textAlign: 'center' }}>
                                <div style={{ 
                                    fontSize: '3rem', 
                                    letterSpacing: '3px',
                                    color: '#ff6b6b',
                                    marginBottom: '1rem',
                                }}>
                                    TEAM A
                                </div>
                                <div style={{ 
                                    fontSize: '6rem', 
                                    fontWeight: 'bold',
                                    color: '#ff6b6b',
                                    textShadow: '0 0 30px rgba(255, 107, 107, 0.5)',
                                }}>
                                    {competition?.team_a_score || 0}
                                </div>
                            </div>

                            <div style={{ 
                                fontSize: '3rem', 
                                color: 'rgba(255, 255, 255, 0.3)',
                                letterSpacing: '2px',
                            }}>
                                VS
                            </div>

                            <div style={{ textAlign: 'center' }}>
                                <div style={{ 
                                    fontSize: '3rem', 
                                    letterSpacing: '3px',
                                    color: '#4ecdc4',
                                    marginBottom: '1rem',
                                }}>
                                    TEAM B
                                </div>
                                <div style={{ 
                                    fontSize: '6rem', 
                                    fontWeight: 'bold',
                                    color: '#4ecdc4',
                                    textShadow: '0 0 30px rgba(78, 205, 196, 0.5)',
                                }}>
                                    {competition?.team_b_score || 0}
                                </div>
                            </div>
                        </div>
                    </div>

                    <h3 style={{ 
                        fontSize: '2.5rem', 
                        marginBottom: '2rem',
                        letterSpacing: '3px',
                        color: '#ffd700',
                    }}>
                        EVENTS
                    </h3>
                    
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(350px, 1fr))', gap: '2rem' }}>
                        {events.map(event => (
                            <EventCard 
                                key={event.id} 
                                event={event}
                                players={players}
                                teams={teams}
                                canStart={canStartEvent(event)}
                                isAdmin={currentUser?.is_admin}
                                onStart={() => startEvent(event)}
                                onView={() => viewEvent(event)}
                            />
                        ))}
                    </div>
                </div>
            );
        }

        function EventCard({ event, players, teams, canStart, isAdmin, onStart, onView }) {
            const [isHovered, setIsHovered] = useState(false);
            const [eventScore, setEventScore] = useState(null);
            
            // Load event score if completed or in progress
            useEffect(() => {
                if (event.status === 'completed' || event.status === 'in_progress') {
                    loadEventScore();
                    
                    // Subscribe to real-time updates for live scoring
                    const channel = supabaseClient
                        .channel(`event-score-${event.id}`)
                        .on('postgres_changes', {
                            event: '*',
                            schema: 'public',
                            table: 'matches',
                            filter: `event_id=eq.${event.id}`
                        }, () => {
                            loadEventScore();
                        })
                        .on('postgres_changes', {
                            event: '*',
                            schema: 'public',
                            table: 'poker_players'
                        }, () => {
                            if (event.name === 'Poker') {
                                loadEventScore();
                            }
                        })
                        .subscribe();
                    
                    return () => {
                        supabaseClient.removeChannel(channel);
                    };
                }
            }, [event.status]);

            const loadEventScore = async () => {
                if (event.name === 'Poker') {
                    // Load poker tournament scores
                    const { data: tournament } = await supabaseClient
                        .from('poker_tournament')
                        .select('id')
                        .eq('event_id', event.id)
                        .maybeSingle();
                    
                    if (tournament) {
                        const { data: pokerPlayersData } = await supabaseClient
                            .from('poker_players')
                            .select('*')
                            .eq('tournament_id', tournament.id);
                        
                        if (pokerPlayersData) {
                            let teamAPoints = 0;
                            let teamBPoints = 0;
                            
                            pokerPlayersData.forEach(pp => {
                                const player = players.find(p => p.id === pp.player_id);
                                if (!player) return;
                                
                                const teamAId = teams.find(t => t.name === 'Team A')?.id;
                                if (player.team_id === teamAId) {
                                    teamAPoints += pp.total_points || 0;
                                } else {
                                    teamBPoints += pp.total_points || 0;
                                }
                            });
                            
                            setEventScore({ teamA: teamAPoints, teamB: teamBPoints });
                        }
                    }
                } else {
                    // Load match-based scores
                    const { data: matches } = await supabaseClient
                        .from('matches')
                        .select('*')
                        .eq('event_id', event.id);
                    
                    if (matches) {
                        let teamAWins = 0;
                        let teamBWins = 0;
                        
                        matches.forEach(match => {
                            if (match.winner_team === 'team_a') {
                                teamAWins += match.points_awarded;
                            } else if (match.winner_team === 'team_b') {
                                teamBWins += match.points_awarded;
                            }
                        });
                        
                        setEventScore({ teamA: teamAWins, teamB: teamBWins });
                    }
                }
            };
            
            const getStatusColor = () => {
                if (event.status === 'completed') return '#00ff00';
                if (event.status === 'in_progress' || event.status === 'drafting') return '#ffd700';
                return 'rgba(255, 255, 255, 0.3)';
            };

            const getStatusText = () => {
                if (event.status === 'not_started') return 'NOT STARTED';
                if (event.status === 'drafting') return 'DRAFTING';
                if (event.status === 'in_progress') return 'IN PROGRESS';
                if (event.status === 'completed') return 'COMPLETED';
                return event.status;
            };

            return (
                <div 
                    onMouseEnter={() => setIsHovered(true)}
                    onMouseLeave={() => setIsHovered(false)}
                    style={{
                        background: 'rgba(255, 255, 255, 0.05)',
                        border: '2px solid rgba(255, 255, 255, 0.1)',
                        borderRadius: '12px',
                        padding: '2rem',
                        transition: 'all 0.3s',
                        transform: isHovered ? 'translateY(-5px)' : 'translateY(0)',
                        boxShadow: isHovered ? '0 15px 40px rgba(255, 215, 0, 0.2)' : 'none',
                    }}
                >
                    <div style={{ marginBottom: '1rem' }}>
                        <h4 style={{ fontSize: '2rem', margin: '0 0 0.5rem 0', letterSpacing: '2px' }}>
                            {event.name}
                        </h4>
                        <div style={{ 
                            fontSize: '1rem', 
                            color: getStatusColor(),
                            letterSpacing: '1px',
                        }}>
                            {getStatusText()}
                        </div>
                        {eventScore && (
                            <div style={{
                                fontSize: '1.8rem',
                                color: '#ffd700',
                                marginTop: '0.5rem',
                                fontWeight: 'bold',
                                letterSpacing: '2px',
                            }}>
                                <span style={{ color: '#ff6b6b' }}>{eventScore.teamA}</span>
                                {' - '}
                                <span style={{ color: '#4ecdc4' }}>{eventScore.teamB}</span>
                            </div>
                        )}
                    </div>

                    {event.name !== 'Poker' && (
                        <div style={{ 
                            fontSize: '1.1rem', 
                            color: 'rgba(255, 255, 255, 0.6)',
                            marginBottom: '1.5rem',
                        }}>
                            Max Points: {event.max_points}
                        </div>
                    )}

                    {event.status === 'not_started' && isAdmin && canStart && (
                        <button
                            onClick={onStart}
                            style={{
                                width: '100%',
                                background: 'linear-gradient(135deg, #00ff00, #00cc00)',
                                color: '#ffffff',
                                border: 'none',
                                padding: '1rem',
                                borderRadius: '8px',
                                cursor: 'pointer',
                                fontSize: '1.2rem',
                                fontWeight: 'bold',
                                fontFamily: 'inherit',
                                letterSpacing: '2px',
                            }}
                        >
                            START EVENT
                        </button>
                    )}

                    {event.status !== 'not_started' && (
                        <button
                            onClick={onView}
                            style={{
                                width: '100%',
                                background: 'linear-gradient(135deg, #ffd700, #ffed4e)',
                                color: '#0f0c29',
                                border: 'none',
                                padding: '1rem',
                                borderRadius: '8px',
                                cursor: 'pointer',
                                fontSize: '1.2rem',
                                fontWeight: 'bold',
                                fontFamily: 'inherit',
                                letterSpacing: '2px',
                            }}
                        >
                            VIEW EVENT
                        </button>
                    )}
                </div>
            );
        }

        // =============================================================================
        // EVENT VIEW
        // =============================================================================

        function EventView({ event, teams, players, currentUser, setView, loadData }) {
            return (
                <div>
                    <button 
                        onClick={() => setView('scoreboard')}
                        style={{
                            background: 'none',
                            border: 'none',
                            color: 'rgba(255, 255, 255, 0.7)',
                            fontSize: '1.1rem',
                            cursor: 'pointer',
                            marginBottom: '2rem',
                            fontFamily: 'inherit',
                        }}
                    >
                        ‚Üê BACK TO SCOREBOARD
                    </button>
                    
                    <div style={{ 
                        textAlign: 'center', 
                        marginBottom: '3rem',
                        background: 'rgba(255, 215, 0, 0.1)',
                        padding: '2rem',
                        borderRadius: '12px',
                        border: '2px solid rgba(255, 215, 0, 0.3)',
                    }}>
                        <h2 style={{ fontSize: '3.5rem', margin: 0, letterSpacing: '4px', color: '#ffd700' }}>
                            {event.name}
                        </h2>
                        <div style={{ fontSize: '1.3rem', color: 'rgba(255, 255, 255, 0.7)', marginTop: '1rem' }}>
                            Status: {event.status.toUpperCase()}
                        </div>
                        
                        {/* Reset button - only for Chris */}
                        {currentUser?.name === 'Chris' && (
                            <button
                                onClick={async () => {
                                    if (confirm('Are you sure you want to RESET this event? This will delete all data and start over.')) {
                                        // Revert the points first (regardless of status)
                                        const { data: competition } = await supabaseClient
                                            .from('competition')
                                            .select('*')
                                            .single();
                                        
                                        let teamARevert = 0;
                                        let teamBRevert = 0;
                                        
                                        if (event.name === 'Poker') {
                                                // Get all poker players and sum their points
                                                const { data: tournament } = await supabaseClient
                                                    .from('poker_tournament')
                                                    .select('id')
                                                    .eq('event_id', event.id)
                                                    .maybeSingle();
                                                
                                                if (tournament) {
                                                    const { data: pokerPlayersData } = await supabaseClient
                                                        .from('poker_players')
                                                        .select('*')
                                                        .eq('tournament_id', tournament.id);
                                                    
                                                    if (pokerPlayersData) {
                                                        pokerPlayersData.forEach(pp => {
                                                            const player = players.find(p => p.id === pp.player_id);
                                                            if (!player) return;
                                                            
                                                            const teamAId = teams.find(t => t.name === 'Team A')?.id;
                                                            if (player.team_id === teamAId) {
                                                                teamARevert += pp.total_points || 0;
                                                            } else {
                                                                teamBRevert += pp.total_points || 0;
                                                            }
                                                        });
                                                    }
                                                }
                                            } else {
                                                // Get all matches and sum points
                                                const { data: eventMatches } = await supabaseClient
                                                    .from('matches')
                                                    .select('*')
                                                    .eq('event_id', event.id);
                                                
                                                if (eventMatches) {
                                                    eventMatches.forEach(match => {
                                                        if (match.is_confirmed) {
                                                            if (match.winner_team === 'team_a') {
                                                                teamARevert += match.points_awarded;
                                                            } else if (match.winner_team === 'team_b') {
                                                                teamBRevert += match.points_awarded;
                                                            }
                                                        }
                                                    });
                                                }
                                            }
                                            
                                            // Revert the scores
                                            await supabaseClient
                                                .from('competition')
                                                .update({
                                                    team_a_score: competition.team_a_score - teamARevert,
                                                    team_b_score: competition.team_b_score - teamBRevert
                                                })
                                                .eq('id', competition.id);
                                        
                                        if (event.name === 'Poker') {
                                            // Delete poker-specific data
                                            const { data: tournament, error } = await supabaseClient
                                                .from('poker_tournament')
                                                .select('id')
                                                .eq('event_id', event.id)
                                                .maybeSingle();
                                            
                                            if (tournament) {
                                                // Delete poker players
                                                await supabaseClient
                                                    .from('poker_players')
                                                    .delete()
                                                    .eq('tournament_id', tournament.id);
                                                
                                                // Delete tables
                                                await supabaseClient
                                                    .from('poker_tables')
                                                    .delete()
                                                    .eq('tournament_id', tournament.id);
                                                
                                                // Delete tournament
                                                await supabaseClient
                                                    .from('poker_tournament')
                                                    .delete()
                                                    .eq('id', tournament.id);
                                            }
                                        } else {
                                            // Delete all draft picks for this event
                                            await supabaseClient
                                                .from('draft_picks')
                                                .delete()
                                                .eq('event_id', event.id);
                                            
                                            // Delete any double-play records for this event
                                            await supabaseClient
                                                .from('player_double_plays')
                                                .delete()
                                                .eq('event_id', event.id);
                                            
                                            // Delete matches
                                            await supabaseClient
                                                .from('matches')
                                                .delete()
                                                .eq('event_id', event.id);
                                        }
                                        
                                        // Reset event status
                                        await supabaseClient
                                            .from('events')
                                            .update({
                                                status: 'not_started',
                                                draft_team_turn: null,
                                                current_draft_pick: 0
                                            })
                                            .eq('id', event.id);
                                        
                                        // Go back to scoreboard
                                        await loadData();
                                        setView('scoreboard');
                                    }
                                }}
                                style={{
                                    marginTop: '1.5rem',
                                    background: 'linear-gradient(135deg, #ff4444, #cc0000)',
                                    color: '#ffffff',
                                    border: 'none',
                                    padding: '0.8rem 2rem',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1rem',
                                    fontWeight: 'bold',
                                    fontFamily: 'inherit',
                                    letterSpacing: '2px',
                                }}
                            >
                                üîÑ RESET EVENT
                            </button>
                        )}
                    </div>

                    {event.status === 'drafting' && (
                        <DraftView 
                            event={event}
                            teams={teams}
                            players={players}
                            currentUser={currentUser}
                            loadData={loadData}
                            setView={setView}
                        />
                    )}

                    {event.status === 'in_progress' && (
                        event.name === 'Poker' ? (
                            <PokerTournamentView
                                event={event}
                                teams={teams}
                                players={players}
                                currentUser={currentUser}
                                loadData={loadData}
                            />
                        ) : (
                            <ScoreRecordingView 
                                event={event}
                                teams={teams}
                                players={players}
                                currentUser={currentUser}
                                loadData={loadData}
                            />
                        )
                    )}
                    
                    {event.status === 'completed' && (
                        event.name === 'Poker' ? (
                            <CompletedPokerView
                                event={event}
                                teams={teams}
                                players={players}
                            />
                        ) : (
                            <CompletedEventView 
                                event={event}
                                teams={teams}
                                players={players}
                            />
                        )
                    )}
                </div>
            );
        }

        // Helper function to create match records from draft picks
        async function createMatchesFromDraft(event, singlesPicks, doublesPicks) {
            const matches = [];
            
            // Create singles matches (6 matches from 12 picks)
            const pickPairs = [[0,1], [2,3], [4,5], [6,7], [8,9], [10,11]];
            pickPairs.forEach((pair, index) => {
                const pick1 = singlesPicks[pair[0]];
                const pick2 = singlesPicks[pair[1]];
                
                if (pick1 && pick2) {
                    matches.push({
                        event_id: event.id,
                        match_number: index + 1,
                        match_type: 'singles',
                        team_a_player1_id: pick1.team === 'team_a' ? pick1.player_id : pick2.player_id,
                        team_b_player1_id: pick1.team === 'team_b' ? pick1.player_id : pick2.player_id,
                        points_awarded: 1
                    });
                }
            });
            
            // Create doubles matches if present (2 matches from 4 picks)
            if (doublesPicks && doublesPicks.length >= 4) {
                const doublesPairs = [[0,1], [2,3]];
                doublesPairs.forEach((pair, index) => {
                    const pick1 = doublesPicks[pair[0]];
                    const pick2 = doublesPicks[pair[1]];
                    
                    if (pick1 && pick2) {
                        const teamAPick = pick1.team === 'team_a' ? pick1 : pick2;
                        const teamBPick = pick1.team === 'team_b' ? pick1 : pick2;
                        
                        matches.push({
                            event_id: event.id,
                            match_number: 100 + index + 1, // Different number range for doubles
                            match_type: 'doubles',
                            team_a_player1_id: teamAPick.player_id,
                            team_a_player2_id: teamAPick.player2_id,
                            team_b_player1_id: teamBPick.player_id,
                            team_b_player2_id: teamBPick.player2_id,
                            points_awarded: 1
                        });
                    }
                });
            }
            
            // Insert all matches
            if (matches.length > 0) {
                await supabaseClient.from('matches').insert(matches);
            }
        }

        // Helper for Computer Games team events
        async function createComputerGamesMatches(event, singlesPicks) {
            console.log('Creating Computer Games matches, event:', event, 'singlesPicks:', singlesPicks.length);
            const matches = [];
            
            // Create 6 Tekken singles matches
            const pickPairs = [[0,1], [2,3], [4,5], [6,7], [8,9], [10,11]];
            pickPairs.forEach((pair, index) => {
                const pick1 = singlesPicks[pair[0]];
                const pick2 = singlesPicks[pair[1]];
                
                if (pick1 && pick2) {
                    matches.push({
                        event_id: event.id,
                        match_number: index + 1,
                        match_type: 'singles',
                        team_a_player1_id: pick1.team === 'team_a' ? pick1.player_id : pick2.player_id,
                        team_b_player1_id: pick1.team === 'team_b' ? pick1.player_id : pick2.player_id,
                        points_awarded: 1
                    });
                }
            });
            
            // Create Worms team match (2 points)
            matches.push({
                event_id: event.id,
                match_number: 201,
                match_type: 'team',
                points_awarded: 2
            });
            
            // Create Keep Talking team match (2 points)
            matches.push({
                event_id: event.id,
                match_number: 202,
                match_type: 'team',
                points_awarded: 2
            });
            
            console.log('About to insert', matches.length, 'matches:', matches);
            
            // Insert all matches
            if (matches.length > 0) {
                try {
                    const { data, error } = await supabaseClient.from('matches').insert(matches);
                    if (error) {
                        console.error('Error inserting matches:', error);
                    } else {
                        console.log('Successfully inserted matches:', data);
                    }
                } catch (err) {
                    console.error('Exception inserting matches:', err);
                }
            }
        }

        // =============================================================================
        // POKER TOURNAMENT VIEW  
        // =============================================================================

        function PokerTournamentView({ event, teams, players, currentUser, loadData }) {
            const [tournament, setTournament] = useState(null);
            const [pokerPlayers, setPokerPlayers] = useState([]);
            const [tables, setTables] = useState([]);
            const [selectedEliminated, setSelectedEliminated] = useState(null);
            const [loading, setLoading] = useState(true);

            const isChris = currentUser?.name === 'Chris';

            useEffect(() => {
                loadTournamentData();

                // Subscribe to updates
                const channel = supabaseClient
                    .channel('poker-updates')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'poker_players'
                    }, () => {
                        loadTournamentData();
                    })
                    .subscribe();

                return () => {
                    supabaseClient.removeChannel(channel);
                };
            }, [event.id]);

            const loadTournamentData = async () => {
                console.log('Loading tournament data for event:', event.id);
                
                // Load tournament
                const { data: tournamentData, error: tournamentError } = await supabaseClient
                    .from('poker_tournament')
                    .select('*')
                    .eq('event_id', event.id)
                    .maybeSingle(); // Use maybeSingle instead of single to avoid errors

                console.log('Tournament query result:', tournamentData, tournamentError);

                setTournament(tournamentData);

                if (!tournamentData) {
                    console.log('No tournament found');
                    setLoading(false);
                    return;
                }

                // Load tables
                const { data: tablesData } = await supabaseClient
                    .from('poker_tables')
                    .select('*')
                    .eq('tournament_id', tournamentData.id)
                    .order('table_number');

                console.log('Loaded tables:', tablesData);
                setTables(tablesData || []);

                // Load poker players
                const { data: playersData } = await supabaseClient
                    .from('poker_players')
                    .select('*')
                    .eq('tournament_id', tournamentData.id)
                    .order('is_eliminated')
                    .order('position', { nullsFirst: true });

                console.log('Loaded poker players:', playersData);
                setPokerPlayers(playersData || []);
                setLoading(false);
            };

            const eliminatePlayer = async (eliminatedPlayerId, eliminatorPlayerId) => {
                const activePlayers = pokerPlayers.filter(p => !p.is_eliminated);
                const eliminationOrder = 11 - activePlayers.length + 1;

                // Calculate position (11th eliminated = 1st place, 1st eliminated = 11th place)
                const finalPosition = 12 - eliminationOrder;

                // Position points: 1st=7, 2nd=4, 3rd=3, 4th=2, 5th=1, rest=0
                const positionPoints = {
                    1: 7,
                    2: 4,
                    3: 3,
                    4: 2,
                    5: 1
                }[finalPosition] || 0;

                // Update eliminated player - PRESERVE their knockout points!
                const { data: eliminatedPlayerData } = await supabaseClient
                    .from('poker_players')
                    .select('knockout_points')
                    .eq('id', eliminatedPlayerId)
                    .single();
                
                const existingKnockouts = eliminatedPlayerData?.knockout_points || 0;
                
                await supabaseClient
                    .from('poker_players')
                    .update({
                        is_eliminated: true,
                        elimination_order: eliminationOrder,
                        position: finalPosition,
                        eliminated_by_player_id: eliminatorPlayerId,
                        position_points: positionPoints,
                        total_points: positionPoints + existingKnockouts // Keep their knockouts!
                    })
                    .eq('id', eliminatedPlayerId);

                // Add knockout point to eliminator ONLY if they eliminated someone from the opposing team
                console.log('Checking knockout. Eliminator player_id:', eliminatorPlayerId, 'Eliminated poker_player_id:', eliminatedPlayerId);
                
                // Get the eliminated player from poker_players
                const { data: eliminatedPokerPlayer } = await supabaseClient
                    .from('poker_players')
                    .select('player_id')
                    .eq('id', eliminatedPlayerId)
                    .single();
                
                // Get eliminator from poker_players (search by player_id only, then filter by tournament)
                // First get the current tournament ID fresh from database
                const { data: currentTournament } = await supabaseClient
                    .from('poker_tournament')
                    .select('id')
                    .eq('event_id', event.id)
                    .maybeSingle();
                
                console.log('Current tournament ID:', currentTournament?.id);
                console.log('Eliminator player_id we are searching for:', eliminatorPlayerId, 'Type:', typeof eliminatorPlayerId);
                
                if (!eliminatorPlayerId) {
                    console.error('ERROR: eliminatorPlayerId is null/undefined!');
                    return;
                }
                
                console.log('Querying poker_players for player_id:', eliminatorPlayerId, 'tournament_id:', currentTournament.id);
                
                const { data: eliminatorResults, error: eliminatorError } = await supabaseClient
                    .from('poker_players')
                    .select('*')
                    .eq('player_id', eliminatorPlayerId)
                    .eq('tournament_id', currentTournament.id);
                
                const freshEliminator = eliminatorResults && eliminatorResults.length > 0 ? eliminatorResults[0] : null;
                
                console.log('Eliminator query results:', eliminatorResults, 'Error:', eliminatorError);
                console.log('Fresh eliminator found:', freshEliminator);
                
                // CRITICAL: Verify the returned record actually matches what we searched for
                if (freshEliminator && freshEliminator.player_id !== eliminatorPlayerId) {
                    console.error('CRITICAL BUG: Query returned wrong player!');
                    console.error('Searched for:', eliminatorPlayerId);
                    console.error('Got back:', freshEliminator.player_id);
                    return;
                }
                
                if (!freshEliminator) {
                    console.error('CRITICAL ERROR: No poker_player record found for this player in current tournament!');
                    console.error('Player ID:', eliminatorPlayerId);
                    console.error('Tournament ID:', currentTournament.id);
                    return;
                }
                
                console.log('Eliminated poker player:', eliminatedPokerPlayer);
                console.log('Fresh eliminator (filtered to current tournament):', freshEliminator, 'Expected tournament:', currentTournament?.id);
                
                if (!freshEliminator) {
                    console.error('ERROR: Could not find eliminator in current tournament! This means poker_players were not created properly.');
                    return;
                }
                
                if (freshEliminator && eliminatedPokerPlayer) {
                    // Get team IDs from the players array
                    const eliminatorPlayer = players.find(p => p.id === eliminatorPlayerId);
                    const eliminatedPlayer = players.find(p => p.id === eliminatedPokerPlayer.player_id);
                    
                    console.log('Eliminator player:', eliminatorPlayer);
                    console.log('Eliminated player:', eliminatedPlayer);
                    
                    if (eliminatorPlayer && eliminatedPlayer) {
                        const eliminatorTeamId = eliminatorPlayer.team_id;
                        const eliminatedTeamId = eliminatedPlayer.team_id;
                        
                        console.log('Eliminator team:', eliminatorTeamId, 'Eliminated team:', eliminatedTeamId);
                        
                        if (eliminatorTeamId !== eliminatedTeamId) {
                            const newKnockoutPoints = (freshEliminator.knockout_points || 0) + 1;
                            const newTotalPoints = (freshEliminator.position_points || 0) + newKnockoutPoints;
                            
                            console.log('DIFFERENT TEAMS! Awarding knockout point:', {
                                eliminator: eliminatorPlayer.name,
                                eliminated: eliminatedPlayer.name,
                                currentKO: freshEliminator.knockout_points,
                                newKO: newKnockoutPoints,
                                positionPts: freshEliminator.position_points,
                                newTotal: newTotalPoints
                            });
                            
                            console.log('ABOUT TO UPDATE:', {
                                id: freshEliminator.id,
                                updating: {
                                    knockout_points: newKnockoutPoints,
                                    total_points: newTotalPoints
                                }
                            });
                            
                            const { data: updateData, error: updateError } = await supabaseClient
                                .from('poker_players')
                                .update({
                                    knockout_points: newKnockoutPoints,
                                    total_points: newTotalPoints
                                })
                                .eq('id', freshEliminator.id)
                                .select();
                            
                            console.log('Update attempted. Error:', updateError, 'Returned data:', updateData);
                            
                            // Verify the update worked
                            const { data: verification } = await supabaseClient
                                .from('poker_players')
                                .select('id, knockout_points, total_points')
                                .eq('id', freshEliminator.id)
                                .single();
                            
                            console.log('Verification - what is actually in database:', verification);
                        } else {
                            console.log('SAME TEAM - no knockout point awarded');
                        }
                    }
                } else {
                    console.error('Could not find eliminator or eliminated player!');
                }

                setSelectedEliminated(null);
                await loadTournamentData();

                // Check if only one player remains - use current tournament ID not stale state
                const remainingAfterElimination = activePlayers.length - 1;
                if (remainingAfterElimination === 1 && currentTournament) {
                    // Last player wins - fetch fresh data from CURRENT tournament
                    const { data: freshPlayers } = await supabaseClient
                        .from('poker_players')
                        .select('*')
                        .eq('tournament_id', currentTournament.id)
                        .eq('is_eliminated', false);
                    
                    console.log('One player remains! Fresh players check:', freshPlayers);
                    
                    const winner = freshPlayers && freshPlayers.length === 1 ? freshPlayers[0] : null;
                    if (winner) {
                        const winnerKnockouts = winner.knockout_points || 0;
                        console.log('Setting winner:', winner.id, 'with', winnerKnockouts, 'knockouts');
                        await supabaseClient
                            .from('poker_players')
                            .update({
                                position: 1,
                                position_points: 7,
                                total_points: 7 + winnerKnockouts,
                                is_eliminated: false // Winner stays active but we mark position
                            })
                            .eq('id', winner.id);
                    }
                    
                    console.log('Calling completeTournament...');
                    await completeTournament();
                }
            };

            const completeTournament = async () => {
                // Fetch fresh poker players data
                const { data: freshPokerPlayers } = await supabaseClient
                    .from('poker_players')
                    .select('*')
                    .eq('tournament_id', tournament.id);

                // Award points to teams based on poker results
                const { data: competition } = await supabaseClient
                    .from('competition')
                    .select('*')
                    .single();

                let teamAPoints = 0;
                let teamBPoints = 0;

                freshPokerPlayers.forEach(pp => {
                    const player = players.find(p => p.id === pp.player_id);
                    if (!player) return;

                    const teamAId = teams.find(t => t.name === 'Team A')?.id;
                    if (player.team_id === teamAId) {
                        teamAPoints += pp.total_points || 0;
                    } else {
                        teamBPoints += pp.total_points || 0;
                    }
                });

                console.log('Tournament complete! Team A points:', teamAPoints, 'Team B points:', teamBPoints);

                await supabaseClient
                    .from('competition')
                    .update({
                        team_a_score: competition.team_a_score + teamAPoints,
                        team_b_score: competition.team_b_score + teamBPoints
                    })
                    .eq('id', competition.id);

                await supabaseClient
                    .from('events')
                    .update({ status: 'completed' })
                    .eq('id', event.id);

                await supabaseClient
                    .from('poker_tournament')
                    .update({ status: 'completed' })
                    .eq('id', tournament.id);

                await loadData();
            };

            if (loading) {
                return <div style={{ textAlign: 'center', padding: '2rem' }}>Loading tournament...</div>;
            }

            if (!tournament) {
                return (
                    <div style={{ 
                        textAlign: 'center', 
                        padding: '4rem',
                        color: 'rgba(255, 255, 255, 0.7)',
                    }}>
                        <div style={{ fontSize: '1.5rem', marginBottom: '1rem' }}>
                            No tournament data found.
                        </div>
                        <div style={{ fontSize: '1rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                            Event may need to be reset and restarted.
                        </div>
                    </div>
                );
            }

            const activePlayers = pokerPlayers.filter(p => !p.is_eliminated);
            const eliminatedPlayers = pokerPlayers.filter(p => p.is_eliminated).sort((a, b) => b.elimination_order - a.elimination_order);

            return (
                <div>
                    <h3 style={{ fontSize: '2.5rem', marginBottom: '2rem', letterSpacing: '3px', color: '#ffd700', textAlign: 'center' }}>
                        POKER TOURNAMENT
                    </h3>

                    {/* Live Score */}
                    {(() => {
                        const teamAId = teams.find(t => t.name === 'Team A')?.id;
                        let teamAPoints = 0;
                        let teamBPoints = 0;
                        
                        pokerPlayers.forEach(pp => {
                            const player = players.find(p => p.id === pp.player_id);
                            if (!player) return;
                            
                            if (player.team_id === teamAId) {
                                teamAPoints += pp.total_points || 0;
                            } else {
                                teamBPoints += pp.total_points || 0;
                            }
                        });
                        
                        return (
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: '1fr auto 1fr',
                                gap: '2rem',
                                alignItems: 'center',
                                marginBottom: '2rem',
                                padding: '1.5rem',
                                background: 'rgba(255, 255, 255, 0.05)',
                                borderRadius: '12px',
                            }}>
                                <div style={{ textAlign: 'center' }}>
                                    <div style={{ fontSize: '1.2rem', color: 'rgba(255, 107, 107, 0.7)', marginBottom: '0.5rem' }}>
                                        TEAM A
                                    </div>
                                    <div style={{ fontSize: '3rem', color: '#ff6b6b', fontWeight: 'bold' }}>
                                        {teamAPoints}
                                    </div>
                                </div>
                                <div style={{ fontSize: '2rem', color: 'rgba(255, 255, 255, 0.3)' }}>-</div>
                                <div style={{ textAlign: 'center' }}>
                                    <div style={{ fontSize: '1.2rem', color: 'rgba(78, 205, 196, 0.7)', marginBottom: '0.5rem' }}>
                                        TEAM B
                                    </div>
                                    <div style={{ fontSize: '3rem', color: '#4ecdc4', fontWeight: 'bold' }}>
                                        {teamBPoints}
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    {/* Winner Banner */}
                    {activePlayers.length === 1 && (
                        <div style={{
                            marginBottom: '2rem',
                            padding: '2rem',
                            background: 'rgba(255, 215, 0, 0.2)',
                            border: '3px solid #ffd700',
                            borderRadius: '12px',
                            textAlign: 'center',
                        }}>
                            <div style={{ fontSize: '3rem', marginBottom: '1rem' }}>üëë</div>
                            <div style={{ fontSize: '2rem', color: '#ffd700', marginBottom: '0.5rem' }}>
                                WINNER
                            </div>
                            <div style={{ fontSize: '2.5rem', fontWeight: 'bold' }}>
                                {players.find(p => p.id === activePlayers[0].player_id)?.name}
                            </div>
                            <div style={{ fontSize: '1.3rem', color: 'rgba(255, 255, 255, 0.7)', marginTop: '1rem' }}>
                                {activePlayers[0].total_points || 7} points
                            </div>
                        </div>
                    )}

                    {isChris && activePlayers.length > 1 && (
                        <div style={{
                            marginBottom: '2rem',
                            padding: '1.5rem',
                            background: 'rgba(255, 215, 0, 0.1)',
                            border: '2px solid rgba(255, 215, 0, 0.3)',
                            borderRadius: '8px',
                            textAlign: 'center',
                            fontSize: '1.1rem',
                        }}>
                            üé∞ Select the next player eliminated, then choose who knocked them out
                        </div>
                    )}

                    {/* Reset Tournament Button - Chris only */}
                    {isChris && tournament && (
                        <div style={{ marginBottom: '2rem', textAlign: 'center' }}>
                            <button
                                onClick={async () => {
                                    if (confirm('RESET tournament? This will put all players back at their original tables and clear all eliminations.')) {
                                        // Reset all poker players
                                        await supabaseClient
                                            .from('poker_players')
                                            .update({
                                                is_eliminated: false,
                                                elimination_order: null,
                                                position: null,
                                                eliminated_by_player_id: null,
                                                position_points: 0,
                                                knockout_points: 0,
                                                total_points: 0
                                            })
                                            .eq('tournament_id', tournament.id);
                                        
                                        await loadTournamentData();
                                    }
                                }}
                                style={{
                                    padding: '0.75rem 2rem',
                                    background: 'linear-gradient(135deg, #ff4444, #cc0000)',
                                    color: '#ffffff',
                                    border: 'none',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1rem',
                                    fontWeight: 'bold',
                                    fontFamily: 'inherit',
                                    letterSpacing: '2px',
                                }}
                            >
                                üîÑ RESET TOURNAMENT
                            </button>
                        </div>
                    )}

                    {/* Tables */}
                    <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(400px, 1fr))', gap: '2rem', marginBottom: '3rem' }}>
                        {tables.map(table => {
                            const tablePlayers = pokerPlayers.filter(p => p.table_id === table.id && !p.is_eliminated);
                            if (tablePlayers.length === 0) return null;

                            return (
                                <div key={table.id} style={{
                                    background: 'rgba(255, 255, 255, 0.05)',
                                    borderRadius: '12px',
                                    border: '2px solid rgba(255, 255, 255, 0.1)',
                                    padding: '2rem',
                                }}>
                                    <h4 style={{ fontSize: '1.5rem', marginBottom: '1.5rem', color: '#ffd700', textAlign: 'center' }}>
                                        TABLE {table.table_number}
                                    </h4>
                                    <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                                        {tablePlayers.map(pp => {
                                            const player = players.find(p => p.id === pp.player_id);
                                            const teamAId = teams.find(t => t.name === 'Team A')?.id;
                                            const isTeamA = player?.team_id === teamAId;

                                            return (
                                                <button
                                                    key={pp.id}
                                                    onClick={() => isChris && setSelectedEliminated(pp)}
                                                    disabled={!isChris}
                                                    style={{
                                                        padding: '1rem',
                                                        background: selectedEliminated?.id === pp.id
                                                            ? 'rgba(255, 215, 0, 0.3)'
                                                            : isTeamA 
                                                                ? 'rgba(255, 107, 107, 0.2)'
                                                                : 'rgba(78, 205, 196, 0.2)',
                                                        border: selectedEliminated?.id === pp.id
                                                            ? '3px solid #ffd700'
                                                            : isTeamA
                                                                ? '2px solid rgba(255, 107, 107, 0.5)'
                                                                : '2px solid rgba(78, 205, 196, 0.5)',
                                                        borderRadius: '8px',
                                                        cursor: isChris ? 'pointer' : 'default',
                                                        fontSize: '1.2rem',
                                                        color: isTeamA ? '#ff6b6b' : '#4ecdc4',
                                                        fontFamily: 'inherit',
                                                        textAlign: 'left',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        gap: '0.5rem',
                                                    }}
                                                >
                                                    <span style={{ 
                                                        background: 'rgba(255, 255, 255, 0.1)',
                                                        borderRadius: '50%',
                                                        width: '30px',
                                                        height: '30px',
                                                        display: 'flex',
                                                        alignItems: 'center',
                                                        justifyContent: 'center',
                                                        fontSize: '0.9rem',
                                                    }}>
                                                        {pp.position}
                                                    </span>
                                                    {player?.name}
                                                </button>
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Eliminator Selection */}
                    {isChris && selectedEliminated && (
                        <div style={{
                            marginBottom: '2rem',
                            padding: '2rem',
                            background: 'rgba(255, 215, 0, 0.1)',
                            borderRadius: '12px',
                            border: '2px solid #ffd700',
                        }}>
                            <h4 style={{ fontSize: '1.5rem', marginBottom: '1rem', color: '#ffd700' }}>
                                Who eliminated {players.find(p => p.id === selectedEliminated.player_id)?.name}?
                            </h4>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(150px, 1fr))', gap: '1rem' }}>
                                {activePlayers
                                    .filter(p => p.id !== selectedEliminated.id)
                                    .map(pp => {
                                        const player = players.find(p => p.id === pp.player_id);
                                        return (
                                            <button
                                                key={pp.id}
                                                onClick={() => eliminatePlayer(selectedEliminated.id, pp.player_id)}
                                                style={{
                                                    padding: '1rem',
                                                    background: 'rgba(255, 255, 255, 0.1)',
                                                    border: '2px solid rgba(255, 255, 255, 0.3)',
                                                    borderRadius: '8px',
                                                    cursor: 'pointer',
                                                    fontSize: '1.1rem',
                                                    color: '#ffffff',
                                                    fontFamily: 'inherit',
                                                }}
                                            >
                                                {player?.name}
                                            </button>
                                        );
                                    })}
                            </div>
                            <button
                                onClick={() => setSelectedEliminated(null)}
                                style={{
                                    marginTop: '1rem',
                                    padding: '0.75rem 1.5rem',
                                    background: 'rgba(255, 255, 255, 0.1)',
                                    border: '2px solid rgba(255, 255, 255, 0.3)',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1rem',
                                    color: '#ffffff',
                                    fontFamily: 'inherit',
                                }}
                            >
                                Cancel
                            </button>
                        </div>
                    )}

                    {/* Eliminated Players */}
                    {eliminatedPlayers.length > 0 && (
                        <div>
                            <h4 style={{ fontSize: '1.5rem', marginBottom: '1rem', color: 'rgba(255, 255, 255, 0.7)' }}>
                                Eliminated ({eliminatedPlayers.length}/11)
                            </h4>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '0.5rem' }}>
                                {eliminatedPlayers.map(pp => {
                                    const player = players.find(p => p.id === pp.player_id);
                                    const eliminator = pp.eliminated_by_player_id ? players.find(p => p.id === pp.eliminated_by_player_id) : null;
                                    
                                    return (
                                        <div key={pp.id} style={{
                                            padding: '1rem',
                                            background: 'rgba(255, 255, 255, 0.05)',
                                            borderRadius: '8px',
                                            display: 'flex',
                                            alignItems: 'center',
                                            gap: '1rem',
                                            fontSize: '1.1rem',
                                        }}>
                                            <span style={{ 
                                                background: 'rgba(255, 255, 255, 0.1)',
                                                borderRadius: '50%',
                                                width: '35px',
                                                height: '35px',
                                                display: 'flex',
                                                alignItems: 'center',
                                                justifyContent: 'center',
                                                fontWeight: 'bold',
                                            }}>
                                                {pp.position}
                                            </span>
                                            <span style={{ flex: 1 }}>{player?.name}</span>
                                            <span style={{ color: 'rgba(255, 255, 255, 0.5)', fontSize: '0.9rem' }}>
                                                KO by: {eliminator?.name || '?'}
                                            </span>
                                            <span style={{ color: '#ffd700', fontWeight: 'bold' }}>
                                                {pp.total_points || 0} pts
                                            </span>
                                        </div>
                                    );
                                })}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // =============================================================================
        // COMPLETED POKER VIEW
        // =============================================================================

        function CompletedPokerView({ event, teams, players }) {
            const [tournament, setTournament] = useState(null);
            const [pokerPlayers, setPokerPlayers] = useState([]);
            const [loading, setLoading] = useState(true);

            const teamA = teams.find(t => t.name === 'Team A');
            const teamB = teams.find(t => t.name === 'Team B');

            useEffect(() => {
                loadTournamentData();
            }, [event.id]);

            const loadTournamentData = async () => {
                const { data: tournamentsData } = await supabaseClient
                    .from('poker_tournament')
                    .select('*')
                    .eq('event_id', event.id)
                    .order('created_at', { ascending: false });

                // Get the most recent tournament
                const tournamentData = tournamentsData && tournamentsData.length > 0 ? tournamentsData[0] : null;
                
                console.log('CompletedPokerView - Found tournaments:', tournamentsData?.length, 'Using:', tournamentData?.id);

                setTournament(tournamentData);

                if (!tournamentData) {
                    setLoading(false);
                    return;
                }

                const { data: playersData } = await supabaseClient
                    .from('poker_players')
                    .select('*')
                    .eq('tournament_id', tournamentData.id)
                    .order('position');

                console.log('CompletedPokerView - Loaded poker players:', playersData);
                setPokerPlayers(playersData || []);
                setLoading(false);
            };

            if (loading) {
                return <div style={{ textAlign: 'center', padding: '2rem' }}>Loading results...</div>;
            }

            if (!tournament) {
                return <div style={{ textAlign: 'center', padding: '2rem' }}>No tournament data found.</div>;
            }

            // Sort by position (1st = best)
            const sortedPlayers = [...pokerPlayers].sort((a, b) => a.position - b.position);

            return (
                <div>
                    <div style={{ 
                        textAlign: 'center', 
                        padding: '2rem',
                        marginBottom: '3rem',
                        background: 'rgba(0, 255, 0, 0.1)',
                        borderRadius: '12px',
                        border: '2px solid rgba(0, 255, 0, 0.3)',
                    }}>
                        <div style={{ fontSize: '3rem', marginBottom: '1rem', color: '#00ff00' }}>
                            ‚úì TOURNAMENT COMPLETED
                        </div>
                        <div style={{ fontSize: '1.3rem', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '1.5rem' }}>
                            Final Standings
                        </div>
                        
                        {/* Final Score */}
                        {(() => {
                            const teamAId = teams.find(t => t.name === 'Team A')?.id;
                            let teamAPoints = 0;
                            let teamBPoints = 0;
                            
                            pokerPlayers.forEach(pp => {
                                const player = players.find(p => p.id === pp.player_id);
                                if (!player) return;
                                
                                if (player.team_id === teamAId) {
                                    teamAPoints += pp.total_points || 0;
                                } else {
                                    teamBPoints += pp.total_points || 0;
                                }
                            });
                            
                            return (
                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: '1fr auto 1fr',
                                    gap: '2rem',
                                    alignItems: 'center',
                                    padding: '1rem',
                                }}>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ fontSize: '1rem', color: 'rgba(255, 107, 107, 0.7)', marginBottom: '0.5rem' }}>
                                            TEAM A
                                        </div>
                                        <div style={{ fontSize: '2.5rem', color: '#ff6b6b', fontWeight: 'bold' }}>
                                            {teamAPoints}
                                        </div>
                                    </div>
                                    <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)' }}>-</div>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ fontSize: '1rem', color: 'rgba(78, 205, 196, 0.7)', marginBottom: '0.5rem' }}>
                                            TEAM B
                                        </div>
                                        <div style={{ fontSize: '2.5rem', color: '#4ecdc4', fontWeight: 'bold' }}>
                                            {teamBPoints}
                                        </div>
                                    </div>
                                </div>
                            );
                        })()}
                    </div>

                    {/* Winner Podium */}
                    <div style={{ marginBottom: '3rem' }}>
                        {sortedPlayers.slice(0, 3).map((pp, index) => {
                            const player = players.find(p => p.id === pp.player_id);
                            const isTeamA = player?.team_id === teamA?.id;
                            const medals = ['ü•á', 'ü•à', 'ü•â'];
                            
                            return (
                                <div key={pp.id} style={{
                                    padding: '2rem',
                                    marginBottom: '1rem',
                                    background: index === 0 
                                        ? 'rgba(255, 215, 0, 0.2)' 
                                        : 'rgba(255, 255, 255, 0.05)',
                                    borderRadius: '12px',
                                    border: index === 0
                                        ? '3px solid #ffd700'
                                        : '2px solid rgba(255, 255, 255, 0.1)',
                                    display: 'flex',
                                    alignItems: 'center',
                                    gap: '2rem',
                                }}>
                                    <div style={{ fontSize: '3rem' }}>
                                        {medals[index]}
                                    </div>
                                    <div style={{ flex: 1 }}>
                                        <div style={{ 
                                            fontSize: '2rem', 
                                            color: isTeamA ? '#ff6b6b' : '#4ecdc4',
                                            marginBottom: '0.5rem',
                                        }}>
                                            {player?.name}
                                        </div>
                                        <div style={{ 
                                            fontSize: '1rem', 
                                            color: 'rgba(255, 255, 255, 0.5)' 
                                        }}>
                                            Position Points: {pp.position_points || 0} | Knockouts: {pp.knockout_points || 0}
                                        </div>
                                    </div>
                                    <div style={{ 
                                        fontSize: '2rem', 
                                        color: '#ffd700',
                                        fontWeight: 'bold',
                                    }}>
                                        {pp.total_points || 0} pts
                                    </div>
                                </div>
                            );
                        })}
                    </div>

                    {/* Full Results */}
                    <div>
                        <h4 style={{ 
                            fontSize: '1.5rem', 
                            marginBottom: '1.5rem', 
                            color: 'rgba(255, 255, 255, 0.7)' 
                        }}>
                            Complete Results
                        </h4>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '0.75rem' }}>
                            {sortedPlayers.map(pp => {
                                const player = players.find(p => p.id === pp.player_id);
                                const eliminator = pp.eliminated_by_player_id 
                                    ? players.find(p => p.id === pp.eliminated_by_player_id) 
                                    : null;
                                const isTeamA = player?.team_id === teamA?.id;
                                
                                return (
                                    <div key={pp.id} style={{
                                        padding: '1.5rem',
                                        background: isTeamA 
                                            ? 'rgba(255, 107, 107, 0.1)' 
                                            : 'rgba(78, 205, 196, 0.1)',
                                        borderRadius: '8px',
                                        display: 'grid',
                                        gridTemplateColumns: '60px 1fr auto auto',
                                        gap: '1.5rem',
                                        alignItems: 'center',
                                        border: isTeamA
                                            ? '1px solid rgba(255, 107, 107, 0.3)'
                                            : '1px solid rgba(78, 205, 196, 0.3)',
                                    }}>
                                        <div style={{ 
                                            fontSize: '1.5rem', 
                                            fontWeight: 'bold',
                                            textAlign: 'center',
                                        }}>
                                            #{pp.position}
                                        </div>
                                        <div>
                                            <div style={{ 
                                                fontSize: '1.3rem', 
                                                color: isTeamA ? '#ff6b6b' : '#4ecdc4',
                                                marginBottom: '0.3rem',
                                            }}>
                                                {player?.name}
                                            </div>
                                            {pp.position !== 1 && eliminator && (
                                                <div style={{ 
                                                    fontSize: '0.9rem', 
                                                    color: 'rgba(255, 255, 255, 0.5)' 
                                                }}>
                                                    Eliminated by: {eliminator.name}
                                                </div>
                                            )}
                                        </div>
                                        <div style={{ 
                                            fontSize: '0.9rem', 
                                            color: 'rgba(255, 255, 255, 0.6)',
                                            textAlign: 'right',
                                        }}>
                                            Pos: {pp.position_points || 0} | KO: {pp.knockout_points || 0}
                                        </div>
                                        <div style={{ 
                                            fontSize: '1.5rem', 
                                            color: '#ffd700',
                                            fontWeight: 'bold',
                                            minWidth: '60px',
                                            textAlign: 'right',
                                        }}>
                                            {pp.total_points || 0}
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        // =============================================================================
        // COMPLETED EVENT VIEW
        // =============================================================================

        function CompletedEventView({ event, teams, players }) {
            const [matches, setMatches] = useState([]);
            const [loading, setLoading] = useState(true);

            const teamA = teams.find(t => t.name === 'Team A');
            const teamB = teams.find(t => t.name === 'Team B');

            useEffect(() => {
                loadMatches();
            }, [event.id]);

            const loadMatches = async () => {
                const { data } = await supabaseClient
                    .from('matches')
                    .select('*')
                    .eq('event_id', event.id)
                    .order('match_number');
                
                setMatches(data || []);
                setLoading(false);
            };

            if (loading) {
                return <div style={{ textAlign: 'center', padding: '2rem' }}>Loading results...</div>;
            }

            const singlesMatches = matches.filter(m => m.match_type === 'singles');
            const doublesMatches = matches.filter(m => m.match_type === 'doubles');
            const teamMatches = matches.filter(m => m.match_type === 'team');

            const getPlayerName = (playerId) => {
                if (!playerId) return null;
                return players.find(p => p.id === playerId)?.name;
            };

            const MatchResultCard = ({ match }) => {
                const teamAPlayer1 = getPlayerName(match.team_a_player1_id);
                const teamAPlayer2 = getPlayerName(match.team_a_player2_id);
                const teamBPlayer1 = getPlayerName(match.team_b_player1_id);
                const teamBPlayer2 = getPlayerName(match.team_b_player2_id);

                const teamADisplay = match.match_type === 'team' ? 'TEAM A' : 
                                     (teamAPlayer2 ? `${teamAPlayer1} & ${teamAPlayer2}` : teamAPlayer1);
                const teamBDisplay = match.match_type === 'team' ? 'TEAM B' :
                                     (teamBPlayer2 ? `${teamBPlayer1} & ${teamBPlayer2}` : teamBPlayer1);

                const teamAWon = match.winner_team === 'team_a';
                const teamBWon = match.winner_team === 'team_b';

                return (
                    <div style={{
                        padding: '1.5rem',
                        background: 'rgba(0, 255, 0, 0.05)',
                        borderRadius: '12px',
                        border: '2px solid rgba(0, 255, 0, 0.3)',
                        position: 'relative',
                    }}>
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                            {/* Team A Side */}
                            <div style={{
                                padding: '1.5rem',
                                background: teamAWon ? 'rgba(255, 215, 0, 0.2)' : 'rgba(255, 107, 107, 0.15)',
                                border: teamAWon ? '3px solid #ffd700' : '2px solid rgba(255, 107, 107, 0.5)',
                                borderRadius: '8px',
                                textAlign: 'center',
                                fontSize: match.match_type === 'team' ? '1.5rem' : '1.3rem',
                                color: '#ff6b6b',
                                position: 'relative',
                            }}>
                                {teamAWon && (
                                    <div style={{
                                        position: 'absolute',
                                        top: '-15px',
                                        left: '50%',
                                        transform: 'translateX(-50%)',
                                        fontSize: '2rem',
                                    }}>
                                        üëë
                                    </div>
                                )}
                                {teamADisplay}
                            </div>

                            <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                                VS
                            </div>

                            {/* Team B Side */}
                            <div style={{
                                padding: '1.5rem',
                                background: teamBWon ? 'rgba(255, 215, 0, 0.2)' : 'rgba(78, 205, 196, 0.15)',
                                border: teamBWon ? '3px solid #ffd700' : '2px solid rgba(78, 205, 196, 0.5)',
                                borderRadius: '8px',
                                textAlign: 'center',
                                fontSize: match.match_type === 'team' ? '1.5rem' : '1.3rem',
                                color: '#4ecdc4',
                                position: 'relative',
                            }}>
                                {teamBWon && (
                                    <div style={{
                                        position: 'absolute',
                                        top: '-15px',
                                        left: '50%',
                                        transform: 'translateX(-50%)',
                                        fontSize: '2rem',
                                    }}>
                                        üëë
                                    </div>
                                )}
                                {teamBDisplay}
                            </div>
                        </div>

                        <div style={{ marginTop: '1rem', textAlign: 'center', fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                            {match.points_awarded} point{match.points_awarded !== 1 ? 's' : ''}
                        </div>
                    </div>
                );
            };

            return (
                <div>
                    <div style={{ 
                        textAlign: 'center', 
                        padding: '2rem',
                        marginBottom: '3rem',
                        background: 'rgba(0, 255, 0, 0.1)',
                        borderRadius: '12px',
                        border: '2px solid rgba(0, 255, 0, 0.3)',
                    }}>
                        <div style={{ fontSize: '3rem', marginBottom: '1rem', color: '#00ff00' }}>
                            ‚úì EVENT COMPLETED
                        </div>
                        <div style={{ fontSize: '1.3rem', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '1.5rem' }}>
                            Final Results
                        </div>
                        
                        {/* Final Score */}
                        {(() => {
                            let teamAPoints = 0;
                            let teamBPoints = 0;
                            
                            matches.forEach(match => {
                                if (match.winner_team === 'team_a') {
                                    teamAPoints += match.points_awarded;
                                } else if (match.winner_team === 'team_b') {
                                    teamBPoints += match.points_awarded;
                                }
                            });
                            
                            return (
                                <div style={{
                                    display: 'grid',
                                    gridTemplateColumns: '1fr auto 1fr',
                                    gap: '2rem',
                                    alignItems: 'center',
                                    padding: '1rem',
                                }}>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ fontSize: '1rem', color: 'rgba(255, 107, 107, 0.7)', marginBottom: '0.5rem' }}>
                                            TEAM A
                                        </div>
                                        <div style={{ fontSize: '2.5rem', color: '#ff6b6b', fontWeight: 'bold' }}>
                                            {teamAPoints}
                                        </div>
                                    </div>
                                    <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)' }}>-</div>
                                    <div style={{ textAlign: 'center' }}>
                                        <div style={{ fontSize: '1rem', color: 'rgba(78, 205, 196, 0.7)', marginBottom: '0.5rem' }}>
                                            TEAM B
                                        </div>
                                        <div style={{ fontSize: '2.5rem', color: '#4ecdc4', fontWeight: 'bold' }}>
                                            {teamBPoints}
                                        </div>
                                    </div>
                                </div>
                            );
                        })()}
                    </div>

                    {/* Singles Matches */}
                    {singlesMatches.length > 0 && (
                        <div style={{ marginBottom: '3rem' }}>
                            <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                                SINGLES
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {singlesMatches.map(match => (
                                    <MatchResultCard key={match.id} match={match} />
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Doubles Matches */}
                    {doublesMatches.length > 0 && (
                        <div style={{ marginBottom: '3rem' }}>
                            <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                                DOUBLES
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {doublesMatches.map(match => (
                                    <MatchResultCard key={match.id} match={match} />
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Team Matches */}
                    {teamMatches.length > 0 && (
                        <div style={{ marginBottom: '3rem' }}>
                            <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                                TEAM EVENTS
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {teamMatches.map(match => (
                                    <MatchResultCard key={match.id} match={match} />
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        // =============================================================================
        // SCORE RECORDING VIEW
        // =============================================================================

        function ScoreRecordingView({ event, teams, players, currentUser, loadData }) {
            const [matches, setMatches] = useState([]);
            const [loading, setLoading] = useState(true);

            const teamA = teams.find(t => t.name === 'Team A');
            const teamB = teams.find(t => t.name === 'Team B');

            useEffect(() => {
                loadMatches();

                // Subscribe to match updates
                const matchChannel = supabaseClient
                    .channel('match-updates')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'matches',
                        filter: `event_id=eq.${event.id}`
                    }, () => {
                        loadMatches();
                    })
                    .subscribe();

                return () => {
                    supabaseClient.removeChannel(matchChannel);
                };
            }, [event.id]);

            const loadMatches = async () => {
                const { data } = await supabaseClient
                    .from('matches')
                    .select('*')
                    .eq('event_id', event.id)
                    .order('match_number');
                
                console.log('Loaded matches for event:', event.name, 'Count:', data?.length, data);
                setMatches(data || []);
                setLoading(false);
            };

            const recordWinner = async (matchId, winnerTeam) => {
                if (!currentUser?.is_admin) return;

                const match = matches.find(m => m.id === matchId);
                const userTeam = currentUser.team_id === teamA?.id ? 'team_a' : 'team_b';

                // Update the appropriate confirmation field
                const updateField = userTeam === 'team_a' ? 'team_a_confirmed_winner' : 'team_b_confirmed_winner';
                
                await supabaseClient
                    .from('matches')
                    .update({
                        [updateField]: winnerTeam
                    })
                    .eq('id', matchId);

                // Check if both admins have confirmed
                const { data: updatedMatch } = await supabaseClient
                    .from('matches')
                    .select('*')
                    .eq('id', matchId)
                    .single();

                if (updatedMatch.team_a_confirmed_winner && updatedMatch.team_b_confirmed_winner) {
                    // Both admins have voted
                    if (updatedMatch.team_a_confirmed_winner === updatedMatch.team_b_confirmed_winner) {
                        // Agreement! Lock in the result
                        await supabaseClient
                            .from('matches')
                            .update({
                                winner_team: updatedMatch.team_a_confirmed_winner,
                                is_confirmed: true
                            })
                            .eq('id', matchId);
                        
                        // Update competition scores
                        await updateCompetitionScores(updatedMatch.team_a_confirmed_winner, updatedMatch.points_awarded);
                    } else {
                        // Disagreement! Clear both selections
                        await supabaseClient
                            .from('matches')
                            .update({
                                team_a_confirmed_winner: null,
                                team_b_confirmed_winner: null
                            })
                            .eq('id', matchId);
                        
                        alert('ADMINS DISAGREE! Selections cleared. Please discuss and try again.');
                    }
                }

                loadMatches();
                loadData();
            };

            const updateCompetitionScores = async (winnerTeam, points) => {
                const { data: competition } = await supabaseClient
                    .from('competition')
                    .select('*')
                    .single();

                const newScores = {
                    team_a_score: competition.team_a_score + (winnerTeam === 'team_a' ? points : 0),
                    team_b_score: competition.team_b_score + (winnerTeam === 'team_b' ? points : 0)
                };

                await supabaseClient
                    .from('competition')
                    .update(newScores)
                    .eq('id', competition.id);
            };

            if (loading) {
                return <div style={{ textAlign: 'center', padding: '2rem' }}>Loading matches...</div>;
            }

            if (matches.length === 0) {
                return (
                    <div style={{ 
                        textAlign: 'center', 
                        padding: '4rem',
                        color: 'rgba(255, 255, 255, 0.7)',
                    }}>
                        <div style={{ fontSize: '1.5rem', marginBottom: '1rem' }}>
                            No matches found for this event.
                        </div>
                        <div style={{ fontSize: '1rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                            Event ID: {event.id}<br/>
                            Event Name: {event.name}
                        </div>
                    </div>
                );
            }

            // Separate matches by type
            const singlesMatches = matches.filter(m => m.match_type === 'singles');
            const doublesMatches = matches.filter(m => m.match_type === 'doubles');
            const teamMatches = matches.filter(m => m.match_type === 'team');

            return (
                <div>
                    <h3 style={{ fontSize: '2.5rem', marginBottom: '2rem', letterSpacing: '3px', color: '#ffd700' }}>
                        RECORD RESULTS
                    </h3>

                    {/* Live Score */}
                    {(() => {
                        let teamAPoints = 0;
                        let teamBPoints = 0;
                        
                        matches.forEach(match => {
                            if (match.is_confirmed) {
                                if (match.winner_team === 'team_a') {
                                    teamAPoints += match.points_awarded;
                                } else if (match.winner_team === 'team_b') {
                                    teamBPoints += match.points_awarded;
                                }
                            }
                        });
                        
                        return (
                            <div style={{
                                display: 'grid',
                                gridTemplateColumns: '1fr auto 1fr',
                                gap: '2rem',
                                alignItems: 'center',
                                marginBottom: '2rem',
                                padding: '1.5rem',
                                background: 'rgba(255, 255, 255, 0.05)',
                                borderRadius: '12px',
                            }}>
                                <div style={{ textAlign: 'center' }}>
                                    <div style={{ fontSize: '1.2rem', color: 'rgba(255, 107, 107, 0.7)', marginBottom: '0.5rem' }}>
                                        TEAM A
                                    </div>
                                    <div style={{ fontSize: '3rem', color: '#ff6b6b', fontWeight: 'bold' }}>
                                        {teamAPoints}
                                    </div>
                                </div>
                                <div style={{ fontSize: '2rem', color: 'rgba(255, 255, 255, 0.3)' }}>-</div>
                                <div style={{ textAlign: 'center' }}>
                                    <div style={{ fontSize: '1.2rem', color: 'rgba(78, 205, 196, 0.7)', marginBottom: '0.5rem' }}>
                                        TEAM B
                                    </div>
                                    <div style={{ fontSize: '3rem', color: '#4ecdc4', fontWeight: 'bold' }}>
                                        {teamBPoints}
                                    </div>
                                </div>
                            </div>
                        );
                    })()}

                    {currentUser?.is_admin && (
                        <div style={{
                            padding: '1rem',
                            background: 'rgba(255, 215, 0, 0.1)',
                            border: '2px solid rgba(255, 215, 0, 0.3)',
                            borderRadius: '8px',
                            marginBottom: '2rem',
                            textAlign: 'center',
                            fontSize: '1.1rem',
                            color: 'rgba(255, 255, 255, 0.8)',
                        }}>
                            üîë Click the winning side. Both admins must agree for result to be recorded.
                        </div>
                    )}

                    {/* Chris-only controls */}
                    {currentUser?.name === 'Chris' && (
                        <div style={{ 
                            display: 'flex', 
                            gap: '1rem', 
                            marginBottom: '2rem',
                            justifyContent: 'center',
                        }}>
                            {/* Complete Event button */}
                            {matches.every(m => m.is_confirmed) && (
                                <button
                                    onClick={async () => {
                                        if (confirm('Mark this event as COMPLETED? This will lock all results.')) {
                                            await supabaseClient
                                                .from('events')
                                                .update({ status: 'completed' })
                                                .eq('id', event.id);
                                            await loadData();
                                        }
                                    }}
                                    style={{
                                        background: 'linear-gradient(135deg, #00ff00, #00cc00)',
                                        color: '#ffffff',
                                        border: 'none',
                                        padding: '1rem 2rem',
                                        borderRadius: '8px',
                                        cursor: 'pointer',
                                        fontSize: '1.2rem',
                                        fontWeight: 'bold',
                                        fontFamily: 'inherit',
                                        letterSpacing: '2px',
                                    }}
                                >
                                    ‚úì COMPLETE EVENT
                                </button>
                            )}
                            
                            {/* Reset All Scores button */}
                            <button
                                onClick={async () => {
                                    if (confirm('RESET ALL SCORES for this event? This will clear all results and revert scores. This cannot be undone!')) {
                                        // Get all matches for this event
                                        const { data: eventMatches } = await supabaseClient
                                            .from('matches')
                                            .select('*')
                                            .eq('event_id', event.id);
                                        
                                        // Revert competition scores
                                        const { data: competition } = await supabaseClient
                                            .from('competition')
                                            .select('*')
                                            .single();
                                        
                                        let teamARevert = 0;
                                        let teamBRevert = 0;
                                        
                                        eventMatches.forEach(match => {
                                            if (match.is_confirmed) {
                                                if (match.winner_team === 'team_a') {
                                                    teamARevert += match.points_awarded;
                                                } else if (match.winner_team === 'team_b') {
                                                    teamBRevert += match.points_awarded;
                                                }
                                            }
                                        });
                                        
                                        await supabaseClient
                                            .from('competition')
                                            .update({
                                                team_a_score: competition.team_a_score - teamARevert,
                                                team_b_score: competition.team_b_score - teamBRevert
                                            })
                                            .eq('id', competition.id);
                                        
                                        // Clear all match results
                                        await supabaseClient
                                            .from('matches')
                                            .update({
                                                winner_team: null,
                                                team_a_confirmed_winner: null,
                                                team_b_confirmed_winner: null,
                                                is_confirmed: false
                                            })
                                            .eq('event_id', event.id);
                                        
                                        await loadMatches();
                                        await loadData();
                                    }
                                }}
                                style={{
                                    background: 'linear-gradient(135deg, #ff4444, #cc0000)',
                                    color: '#ffffff',
                                    border: 'none',
                                    padding: '1rem 2rem',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1.2rem',
                                    fontWeight: 'bold',
                                    fontFamily: 'inherit',
                                    letterSpacing: '2px',
                                }}
                            >
                                üîÑ RESET ALL SCORES
                            </button>
                        </div>
                    )}

                    {/* Singles Matches */}
                    {singlesMatches.length > 0 && (
                        <div style={{ marginBottom: '3rem' }}>
                            <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                                SINGLES
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {singlesMatches.map(match => (
                                    <MatchRecordingCard
                                        key={match.id}
                                        match={match}
                                        players={players}
                                        currentUser={currentUser}
                                        teamA={teamA}
                                        teamB={teamB}
                                        onRecordWinner={recordWinner}
                                    />
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Doubles Matches */}
                    {doublesMatches.length > 0 && (
                        <div style={{ marginBottom: '3rem' }}>
                            <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                                DOUBLES
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {doublesMatches.map(match => (
                                    <MatchRecordingCard
                                        key={match.id}
                                        match={match}
                                        players={players}
                                        currentUser={currentUser}
                                        teamA={teamA}
                                        teamB={teamB}
                                        onRecordWinner={recordWinner}
                                    />
                                ))}
                            </div>
                        </div>
                    )}

                    {/* Team Matches */}
                    {teamMatches.length > 0 && (
                        <div style={{ marginBottom: '3rem' }}>
                            <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                                TEAM EVENTS
                            </div>
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                                {teamMatches.map(match => (
                                    <MatchRecordingCard
                                        key={match.id}
                                        match={match}
                                        players={players}
                                        currentUser={currentUser}
                                        teamA={teamA}
                                        teamB={teamB}
                                        onRecordWinner={recordWinner}
                                    />
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function MatchRecordingCard({ match, players, currentUser, teamA, teamB, onRecordWinner }) {
            const isAdmin = currentUser?.is_admin;
            const userTeam = currentUser?.team_id === teamA?.id ? 'team_a' : 'team_b';
            
            const isConfirmed = match.is_confirmed;
            const teamAConfirmed = match.team_a_confirmed_winner;
            const teamBConfirmed = match.team_b_confirmed_winner;

            // Get player names
            const getPlayerName = (playerId) => {
                if (!playerId) return null;
                return players.find(p => p.id === playerId)?.name;
            };

            const teamAPlayer1 = getPlayerName(match.team_a_player1_id);
            const teamAPlayer2 = getPlayerName(match.team_a_player2_id);
            const teamBPlayer1 = getPlayerName(match.team_b_player1_id);
            const teamBPlayer2 = getPlayerName(match.team_b_player2_id);

            const teamADisplay = match.match_type === 'team' ? 'TEAM A' : 
                                 (teamAPlayer2 ? `${teamAPlayer1} & ${teamAPlayer2}` : teamAPlayer1);
            const teamBDisplay = match.match_type === 'team' ? 'TEAM B' :
                                 (teamBPlayer2 ? `${teamBPlayer1} & ${teamBPlayer2}` : teamBPlayer1);

            // Show confirmation status
            let statusDisplay = null;
            if (isConfirmed) {
                statusDisplay = (
                    <div style={{
                        position: 'absolute',
                        top: '1rem',
                        right: '1rem',
                        padding: '0.5rem 1rem',
                        background: '#00ff00',
                        color: '#0f0c29',
                        borderRadius: '20px',
                        fontSize: '0.9rem',
                        fontWeight: 'bold',
                        display: 'flex',
                        alignItems: 'center',
                        gap: '0.3rem',
                    }}>
                        ‚úì LOCKED
                    </div>
                );
            } else if (teamAConfirmed && teamBConfirmed && teamAConfirmed !== teamBConfirmed) {
                statusDisplay = (
                    <div style={{
                        position: 'absolute',
                        top: '1rem',
                        right: '1rem',
                        padding: '0.5rem 1rem',
                        background: '#ff4444',
                        color: '#ffffff',
                        borderRadius: '20px',
                        fontSize: '0.9rem',
                        fontWeight: 'bold',
                    }}>
                        ‚ö† DISAGREE
                    </div>
                );
            } else if (teamAConfirmed || teamBConfirmed) {
                statusDisplay = (
                    <div style={{
                        position: 'absolute',
                        top: '1rem',
                        right: '1rem',
                        padding: '0.5rem 1rem',
                        background: 'rgba(255, 215, 0, 0.3)',
                        color: '#ffd700',
                        borderRadius: '20px',
                        fontSize: '0.9rem',
                        fontWeight: 'bold',
                    }}>
                        üîë 1/2
                    </div>
                );
            }

            return (
                <div style={{
                    padding: '1.5rem',
                    background: isConfirmed ? 'rgba(0, 255, 0, 0.05)' : 'rgba(255, 255, 255, 0.05)',
                    borderRadius: '12px',
                    border: isConfirmed ? '2px solid rgba(0, 255, 0, 0.3)' : '2px solid rgba(255, 255, 255, 0.1)',
                    position: 'relative',
                }}>
                    {statusDisplay}

                    <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                        {/* Team A Side */}
                        <button
                            onClick={() => !isConfirmed && isAdmin && onRecordWinner(match.id, 'team_a')}
                            disabled={isConfirmed || !isAdmin}
                            style={{
                                padding: '1.5rem',
                                background: match.winner_team === 'team_a' 
                                    ? 'rgba(255, 215, 0, 0.3)' 
                                    : (teamAConfirmed === 'team_a' || teamBConfirmed === 'team_a')
                                        ? 'rgba(255, 107, 107, 0.3)'
                                        : 'rgba(255, 107, 107, 0.15)',
                                border: match.winner_team === 'team_a'
                                    ? '3px solid #ffd700'
                                    : '2px solid rgba(255, 107, 107, 0.5)',
                                borderRadius: '8px',
                                textAlign: 'center',
                                fontSize: match.match_type === 'team' ? '1.5rem' : '1.3rem',
                                color: '#ff6b6b',
                                cursor: isConfirmed || !isAdmin ? 'not-allowed' : 'pointer',
                                fontFamily: 'inherit',
                                letterSpacing: '1px',
                                transition: 'all 0.3s',
                                opacity: isConfirmed ? 0.6 : 1,
                            }}
                            onMouseEnter={e => {
                                if (!isConfirmed && isAdmin) {
                                    e.currentTarget.style.transform = 'scale(1.02)';
                                    e.currentTarget.style.boxShadow = '0 8px 20px rgba(255, 107, 107, 0.3)';
                                }
                            }}
                            onMouseLeave={e => {
                                e.currentTarget.style.transform = 'scale(1)';
                                e.currentTarget.style.boxShadow = 'none';
                            }}
                        >
                            {teamADisplay}
                            {teamAConfirmed === 'team_a' && !isConfirmed && (
                                <div style={{ fontSize: '0.8rem', marginTop: '0.5rem', color: '#ffd700' }}>
                                    {userTeam === 'team_a' ? '‚úì You voted' : '‚úì Other admin voted'}
                                </div>
                            )}
                        </button>

                        <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                            VS
                        </div>

                        {/* Team B Side */}
                        <button
                            onClick={() => !isConfirmed && isAdmin && onRecordWinner(match.id, 'team_b')}
                            disabled={isConfirmed || !isAdmin}
                            style={{
                                padding: '1.5rem',
                                background: match.winner_team === 'team_b'
                                    ? 'rgba(255, 215, 0, 0.3)'
                                    : (teamAConfirmed === 'team_b' || teamBConfirmed === 'team_b')
                                        ? 'rgba(78, 205, 196, 0.3)'
                                        : 'rgba(78, 205, 196, 0.15)',
                                border: match.winner_team === 'team_b'
                                    ? '3px solid #ffd700'
                                    : '2px solid rgba(78, 205, 196, 0.5)',
                                borderRadius: '8px',
                                textAlign: 'center',
                                fontSize: match.match_type === 'team' ? '1.5rem' : '1.3rem',
                                color: '#4ecdc4',
                                cursor: isConfirmed || !isAdmin ? 'not-allowed' : 'pointer',
                                fontFamily: 'inherit',
                                letterSpacing: '1px',
                                transition: 'all 0.3s',
                                opacity: isConfirmed ? 0.6 : 1,
                            }}
                            onMouseEnter={e => {
                                if (!isConfirmed && isAdmin) {
                                    e.currentTarget.style.transform = 'scale(1.02)';
                                    e.currentTarget.style.boxShadow = '0 8px 20px rgba(78, 205, 196, 0.3)';
                                }
                            }}
                            onMouseLeave={e => {
                                e.currentTarget.style.transform = 'scale(1)';
                                e.currentTarget.style.boxShadow = 'none';
                            }}
                        >
                            {teamBDisplay}
                            {teamBConfirmed === 'team_b' && !isConfirmed && (
                                <div style={{ fontSize: '0.8rem', marginTop: '0.5rem', color: '#ffd700' }}>
                                    {userTeam === 'team_b' ? '‚úì You voted' : '‚úì Other admin voted'}
                                </div>
                            )}
                        </button>
                    </div>

                    <div style={{ marginTop: '1rem', textAlign: 'center', fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.5)' }}>
                        Worth {match.points_awarded} point{match.points_awarded !== 1 ? 's' : ''}
                    </div>
                </div>
            );
        }

        // =============================================================================
        // DRAFT VIEW
        // =============================================================================

        // =============================================================================
        // COMPUTER GAMES TEAM EVENTS
        // =============================================================================

        function ComputerGamesTeamEvents({ event, singlesPicks, players, teamA, teamB, currentUser, loadData, setView }) {
            const confirmAndFinish = async () => {
                if (!currentUser?.is_admin) return;
                
                // Create match records for Computer Games
                await createComputerGamesMatches(event, singlesPicks);
                
                // Move event to in_progress
                await supabaseClient
                    .from('events')
                    .update({
                        status: 'in_progress'
                    })
                    .eq('id', event.id);
                
                await loadData();
                setView('scoreboard');
            };
            
            return (
                <div>
                    <div style={{ 
                        marginBottom: '3rem',
                        padding: '2rem',
                        background: 'rgba(255, 255, 255, 0.05)',
                        borderRadius: '12px',
                        border: '2px solid rgba(255, 255, 255, 0.1)',
                    }}>
                        <h3 style={{ fontSize: '2rem', marginBottom: '1rem', color: '#ffd700', textAlign: 'center' }}>
                            TEAM EVENTS
                        </h3>
                        <div style={{ textAlign: 'center', fontSize: '1.1rem', color: 'rgba(255, 255, 255, 0.7)' }}>
                            Worms & Keep Talking and Nobody Explodes
                        </div>
                    </div>

                    {/* Show singles matchups + team events */}
                    <div>
                        <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                            TEKKEN 7 (1v1)
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', marginBottom: '3rem' }}>
                            {[0, 1, 2, 3, 4, 5].map(matchIndex => {
                                const pickIndices = [[0, 1], [2, 3], [4, 5], [6, 7], [8, 9], [10, 11]];
                                const [idx1, idx2] = pickIndices[matchIndex];
                                const pick1 = singlesPicks[idx1];
                                const pick2 = singlesPicks[idx2];
                                
                                const player1 = pick1 ? players.find(pl => pl.id === pick1.player_id) : null;
                                const player2 = pick2 ? players.find(pl => pl.id === pick2.player_id) : null;
                                
                                const teamAPlayer = pick1?.team === 'team_a' ? player1 : player2;
                                const teamBPlayer = pick1?.team === 'team_b' ? player1 : player2;
                                
                                return (
                                    <div key={matchIndex} style={{
                                        padding: '1.5rem',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        borderRadius: '12px',
                                        border: '2px solid rgba(255, 255, 255, 0.1)',
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.5)', marginBottom: '1rem' }}>
                                            Match {matchIndex + 1}
                                        </div>
                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamAPlayer ? 'rgba(255, 107, 107, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamAPlayer ? '2px solid rgba(255, 107, 107, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.3rem',
                                                color: teamAPlayer ? '#ff6b6b' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamAPlayer ? teamAPlayer.name : '???'}
                                            </div>
                                            <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                                                VS
                                            </div>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamBPlayer ? 'rgba(78, 205, 196, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamBPlayer ? '2px solid rgba(78, 205, 196, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.3rem',
                                                color: teamBPlayer ? '#4ecdc4' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamBPlayer ? teamBPlayer.name : '???'}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                            TEAM EVENTS
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', marginBottom: '3rem' }}>
                            {/* Worms */}
                            <div style={{
                                padding: '1.5rem',
                                background: 'rgba(255, 255, 255, 0.05)',
                                borderRadius: '12px',
                                border: '2px solid rgba(255, 255, 255, 0.1)',
                            }}>
                                <div style={{ fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.5)', marginBottom: '1rem' }}>
                                    Worms (Best of 3)
                                </div>
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(255, 107, 107, 0.2)',
                                        border: '2px solid rgba(255, 107, 107, 0.5)',
                                        borderRadius: '8px',
                                        textAlign: 'center',
                                        fontSize: '1.3rem',
                                        color: '#ff6b6b',
                                    }}>
                                        TEAM A
                                    </div>
                                    <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                                        VS
                                    </div>
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(78, 205, 196, 0.2)',
                                        border: '2px solid rgba(78, 205, 196, 0.5)',
                                        borderRadius: '8px',
                                        textAlign: 'center',
                                        fontSize: '1.3rem',
                                        color: '#4ecdc4',
                                    }}>
                                        TEAM B
                                    </div>
                                </div>
                            </div>

                            {/* Keep Talking */}
                            <div style={{
                                padding: '1.5rem',
                                background: 'rgba(255, 255, 255, 0.05)',
                                borderRadius: '12px',
                                border: '2px solid rgba(255, 255, 255, 0.1)',
                            }}>
                                <div style={{ fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.5)', marginBottom: '1rem' }}>
                                    Keep Talking and Nobody Explodes
                                </div>
                                <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(255, 107, 107, 0.2)',
                                        border: '2px solid rgba(255, 107, 107, 0.5)',
                                        borderRadius: '8px',
                                        textAlign: 'center',
                                        fontSize: '1.3rem',
                                        color: '#ff6b6b',
                                    }}>
                                        TEAM A
                                    </div>
                                    <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                                        VS
                                    </div>
                                    <div style={{
                                        padding: '1rem',
                                        background: 'rgba(78, 205, 196, 0.2)',
                                        border: '2px solid rgba(78, 205, 196, 0.5)',
                                        borderRadius: '8px',
                                        textAlign: 'center',
                                        fontSize: '1.3rem',
                                        color: '#4ecdc4',
                                    }}>
                                        TEAM B
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Confirm button - Chris only */}
                        {currentUser?.name === 'Chris' && (
                            <button
                                onClick={confirmAndFinish}
                                style={{
                                    width: '100%',
                                    background: 'linear-gradient(135deg, #00ff00, #00cc00)',
                                    color: '#ffffff',
                                    border: 'none',
                                    padding: '1.5rem',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1.5rem',
                                    fontWeight: 'bold',
                                    fontFamily: 'inherit',
                                    letterSpacing: '2px',
                                }}
                            >
                                ‚úì CONFIRM EVENT - START RECORDING SCORES
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        // =============================================================================
        // DOUBLES PHASE COMPONENT
        // =============================================================================

        function DoublesPhase({ event, teams, players, currentUser, draftPicks, singlesPicks, doublesPicks, teamA, teamB, userTeam, loadDraftPicks, loadEventData, loadData, setView }) {
            const [selectedPlayer1, setSelectedPlayer1] = useState(null);
            const [selectedPlayer2, setSelectedPlayer2] = useState(null);

            const teamAPlayers = players.filter(p => p.team_id === teamA?.id);
            const teamBPlayers = players.filter(p => p.team_id === teamB?.id);
            const myTeamPlayers = userTeam === 'team_a' ? teamAPlayers : teamBPlayers;

            const isMyTurn = event.draft_team_turn === userTeam && currentUser?.is_admin;

            // Get players who have already been picked in doubles
            const playersInDoubles = new Set();
            doublesPicks.forEach(pick => {
                playersInDoubles.add(pick.player_id);
                if (pick.player2_id) playersInDoubles.add(pick.player2_id);
            });

            // Available players = those not yet in a doubles game
            const availablePlayers = myTeamPlayers.filter(p => !playersInDoubles.has(p.id));

            const submitDoublesPick = async () => {
                if (!selectedPlayer1 || !selectedPlayer2) {
                    alert('Please select both players for your doubles pair');
                    return;
                }

                const pickNumber = draftPicks.length;
                const team = event.draft_team_turn;

                // Insert the doubles pick
                await supabaseClient
                    .from('draft_picks')
                    .insert({
                        event_id: event.id,
                        pick_number: pickNumber,
                        team: team,
                        player_id: selectedPlayer1,
                        player2_id: selectedPlayer2,
                        pick_type: 'double'
                    });

                // ABBA pattern for doubles - whoever picked FIRST in singles also picks first in doubles
                // Pattern: First, Second, Second, First
                const currentDoublesCount = doublesPicks.length;
                let nextTeam;
                
                // The team that just picked
                const currentTeam = team;
                
                if (currentDoublesCount === 0) {
                    // Just made pick 1, switch to other team
                    nextTeam = currentTeam === 'team_a' ? 'team_b' : 'team_a';
                } else if (currentDoublesCount === 1) {
                    // Just made pick 2 (second team's first), stay on same team
                    nextTeam = currentTeam;
                } else if (currentDoublesCount === 2) {
                    // Just made pick 3 (second team's second), switch to first team
                    nextTeam = currentTeam === 'team_a' ? 'team_b' : 'team_a';
                } else {
                    // currentDoublesCount === 3, draft complete
                    nextTeam = null;
                }
                
                // Check if drafting is complete (4 doubles picks total)
                const totalDoubles = doublesPicks.length + 1;
                if (totalDoubles >= 4) {
                    // Draft complete! Move to in_progress
                    await supabaseClient
                        .from('events')
                        .update({
                            status: 'in_progress',
                            draft_team_turn: null
                        })
                        .eq('id', event.id);
                } else {
                    await supabaseClient
                        .from('events')
                        .update({
                            draft_team_turn: nextTeam,
                            current_draft_pick: pickNumber + 1
                        })
                        .eq('id', event.id);
                }

                setSelectedPlayer1(null);
                setSelectedPlayer2(null);
                loadDraftPicks();
                loadEventData();
                loadData();
            };

            // Get pairs that have already been picked
            const pickedPairs = doublesPicks.map(p => ({
                team: p.team,
                player1: players.find(pl => pl.id === p.player_id)?.name,
                player2: players.find(pl => pl.id === p.player2_id)?.name,
            }));

            return (
                <div>
                    <div style={{ 
                        marginBottom: '3rem',
                        padding: '2rem',
                        background: 'rgba(255, 255, 255, 0.05)',
                        borderRadius: '12px',
                        border: '2px solid rgba(255, 255, 255, 0.1)',
                    }}>
                        <h3 style={{ fontSize: '2rem', marginBottom: '1rem', color: '#ffd700', textAlign: 'center' }}>
                            DOUBLES DRAFT
                        </h3>
                        <div style={{ textAlign: 'center', fontSize: '1.1rem', color: 'rgba(255, 255, 255, 0.7)', marginBottom: '1rem' }}>
                            Pick 2 players from your team to form a doubles pair
                        </div>
                        
                        {isMyTurn ? (
                            <div style={{ textAlign: 'center', fontSize: '1.5rem', color: '#00ff00', letterSpacing: '2px' }}>
                                YOUR TURN - SELECT YOUR PAIR
                            </div>
                        ) : (
                            <div style={{ textAlign: 'center', fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.5)', letterSpacing: '2px' }}>
                                WAITING FOR {event.draft_team_turn === 'team_a' ? 'TEAM A' : 'TEAM B'}
                            </div>
                        )}
                    </div>

                    {/* Player selection FIRST */}
                    {isMyTurn && (
                        <div style={{ marginBottom: '3rem' }}>
                            <h4 style={{ fontSize: '1.5rem', marginBottom: '1rem', color: '#ffd700' }}>
                                Select Your Doubles Pair (2 players):
                            </h4>
                            
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '1rem', marginBottom: '2rem' }}>
                                {availablePlayers.map(player => {
                                    const isSelected = selectedPlayer1 === player.id || selectedPlayer2 === player.id;
                                    return (
                                        <button
                                            key={player.id}
                                            onClick={() => {
                                                if (isSelected) {
                                                    if (selectedPlayer1 === player.id) setSelectedPlayer1(null);
                                                    if (selectedPlayer2 === player.id) setSelectedPlayer2(null);
                                                } else {
                                                    if (!selectedPlayer1) setSelectedPlayer1(player.id);
                                                    else if (!selectedPlayer2) setSelectedPlayer2(player.id);
                                                }
                                            }}
                                            style={{
                                                background: isSelected
                                                    ? (userTeam === 'team_a' 
                                                        ? 'linear-gradient(135deg, rgba(255, 107, 107, 0.5), rgba(255, 107, 107, 0.4))'
                                                        : 'linear-gradient(135deg, rgba(78, 205, 196, 0.5), rgba(78, 205, 196, 0.4))')
                                                    : (userTeam === 'team_a' 
                                                        ? 'linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(255, 107, 107, 0.2))'
                                                        : 'linear-gradient(135deg, rgba(78, 205, 196, 0.3), rgba(78, 205, 196, 0.2))'),
                                                border: isSelected
                                                    ? (userTeam === 'team_a' ? '3px solid #ff6b6b' : '3px solid #4ecdc4')
                                                    : (userTeam === 'team_a' ? '2px solid rgba(255, 107, 107, 0.5)' : '2px solid rgba(78, 205, 196, 0.5)'),
                                                borderRadius: '12px',
                                                padding: '1.5rem',
                                                cursor: 'pointer',
                                                fontSize: '1.3rem',
                                                color: '#ffffff',
                                                fontFamily: 'inherit',
                                                letterSpacing: '2px',
                                                transition: 'all 0.3s',
                                            }}
                                        >
                                            {player.name}
                                            {isSelected && (
                                                <div style={{ fontSize: '0.9rem', marginTop: '0.5rem', color: '#ffd700' }}>
                                                    ‚úì SELECTED
                                                </div>
                                            )}
                                        </button>
                                    );
                                })}
                            </div>

                            <button
                                onClick={submitDoublesPick}
                                disabled={!selectedPlayer1 || !selectedPlayer2}
                                style={{
                                    width: '100%',
                                    background: selectedPlayer1 && selectedPlayer2
                                        ? 'linear-gradient(135deg, #ffd700, #ffed4e)'
                                        : 'rgba(255, 255, 255, 0.1)',
                                    color: selectedPlayer1 && selectedPlayer2 ? '#0f0c29' : 'rgba(255, 255, 255, 0.3)',
                                    border: 'none',
                                    padding: '1.5rem',
                                    borderRadius: '8px',
                                    cursor: selectedPlayer1 && selectedPlayer2 ? 'pointer' : 'not-allowed',
                                    fontSize: '1.3rem',
                                    fontWeight: 'bold',
                                    fontFamily: 'inherit',
                                    letterSpacing: '2px',
                                }}
                            >
                                CONFIRM DOUBLES PAIR
                            </button>
                        </div>
                    )}

                    {/* Combined Singles + Doubles Matchups Display */}
                    <div>
                        <h4 style={{ fontSize: '1.5rem', marginBottom: '1.5rem', color: 'rgba(255, 255, 255, 0.7)' }}>
                            All Match-ups:
                        </h4>
                        
                        <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                            SINGLES
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem', marginBottom: '3rem' }}>
                            {[0, 1, 2, 3, 4, 5].map(matchIndex => {
                                const pickIndices = [[0, 1], [2, 3], [4, 5], [6, 7], [8, 9], [10, 11]];
                                const [idx1, idx2] = pickIndices[matchIndex];
                                const pick1 = singlesPicks[idx1];
                                const pick2 = singlesPicks[idx2];
                                
                                const player1 = pick1 ? players.find(pl => pl.id === pick1.player_id) : null;
                                const player2 = pick2 ? players.find(pl => pl.id === pick2.player_id) : null;
                                
                                const teamAPlayer = pick1?.team === 'team_a' ? player1 : player2;
                                const teamBPlayer = pick1?.team === 'team_b' ? player1 : player2;
                                
                                return (
                                    <div key={matchIndex} style={{
                                        padding: '1.5rem',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        borderRadius: '12px',
                                        border: '2px solid rgba(255, 255, 255, 0.1)',
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.5)', marginBottom: '1rem' }}>
                                            Singles {matchIndex + 1}
                                        </div>
                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamAPlayer ? 'rgba(255, 107, 107, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamAPlayer ? '2px solid rgba(255, 107, 107, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.3rem',
                                                color: teamAPlayer ? '#ff6b6b' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamAPlayer ? teamAPlayer.name : '???'}
                                            </div>
                                            <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                                                VS
                                            </div>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamBPlayer ? 'rgba(78, 205, 196, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamBPlayer ? '2px solid rgba(78, 205, 196, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.3rem',
                                                color: teamBPlayer ? '#4ecdc4' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamBPlayer ? teamBPlayer.name : '???'}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        <div style={{ fontSize: '1.3rem', color: '#ffd700', marginBottom: '1rem', letterSpacing: '1px' }}>
                            DOUBLES
                        </div>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                            {[0, 1].map(matchIndex => {
                                // Doubles follow ABBA: 
                                // Match 0: pick 0 (A) vs pick 1 (B)
                                // Match 1: pick 2 (B) vs pick 3 (A)
                                const pickIndices = [[0, 1], [2, 3]];
                                const [idx1, idx2] = pickIndices[matchIndex];
                                const pick1 = doublesPicks[idx1];
                                const pick2 = doublesPicks[idx2];
                                
                                const getPlayerNames = (pick) => {
                                    if (!pick) return null;
                                    const p1 = players.find(pl => pl.id === pick.player_id);
                                    const p2 = players.find(pl => pl.id === pick.player2_id);
                                    return p1 && p2 ? `${p1.name} & ${p2.name}` : null;
                                };
                                
                                const teamAPair = pick1?.team === 'team_a' ? getPlayerNames(pick1) : getPlayerNames(pick2);
                                const teamBPair = pick1?.team === 'team_b' ? getPlayerNames(pick1) : getPlayerNames(pick2);
                                
                                return (
                                    <div key={matchIndex} style={{
                                        padding: '1.5rem',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        borderRadius: '12px',
                                        border: '2px solid rgba(255, 255, 255, 0.1)',
                                    }}>
                                        <div style={{ fontSize: '0.9rem', color: 'rgba(255, 255, 255, 0.5)', marginBottom: '1rem' }}>
                                            Doubles {matchIndex + 1}
                                        </div>
                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamAPair ? 'rgba(255, 107, 107, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamAPair ? '2px solid rgba(255, 107, 107, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.1rem',
                                                color: teamAPair ? '#ff6b6b' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamAPair || '???'}
                                            </div>
                                            <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                                                VS
                                            </div>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamBPair ? 'rgba(78, 205, 196, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamBPair ? '2px solid rgba(78, 205, 196, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.1rem',
                                                color: teamBPair ? '#4ecdc4' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamBPair || '???'}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>

                        {/* Confirm button when all doubles are picked - Chris only */}
                        {currentUser?.name === 'Chris' && doublesPicks.length >= 4 && (
                            <button
                                onClick={async () => {
                                    // Create match records from draft picks
                                    await createMatchesFromDraft(event, singlesPicks, doublesPicks);
                                    
                                    await supabaseClient
                                        .from('events')
                                        .update({
                                            status: 'in_progress'
                                        })
                                        .eq('id', event.id);
                                    await loadData();
                                    setView('scoreboard');
                                }}
                                style={{
                                    width: '100%',
                                    background: 'linear-gradient(135deg, #00ff00, #00cc00)',
                                    color: '#ffffff',
                                    border: 'none',
                                    padding: '1.5rem',
                                    borderRadius: '8px',
                                    cursor: 'pointer',
                                    fontSize: '1.5rem',
                                    fontWeight: 'bold',
                                    fontFamily: 'inherit',
                                    letterSpacing: '2px',
                                    marginTop: '2rem',
                                }}
                            >
                                ‚úì CONFIRM EVENT - START RECORDING SCORES
                            </button>
                        )}
                    </div>
                </div>
            );
        }

        // =============================================================================
        // DRAFT VIEW (SINGLES PHASE)
        // =============================================================================

        function DraftView({ event, teams, players, currentUser, loadData, setView }) {
            const [draftPicks, setDraftPicks] = useState([]);
            const [currentEvent, setCurrentEvent] = useState(event);
            const [doublePlayRecords, setDoublePlayRecords] = useState([]);
            const [draftPhase, setDraftPhase] = useState('singles'); // 'singles' or 'doubles'
            const [loading, setLoading] = useState(true);

            const teamA = teams.find(t => t.name === 'Team A');
            const teamB = teams.find(t => t.name === 'Team B');
            const teamAPlayers = players.filter(p => p.team_id === teamA?.id);
            const teamBPlayers = players.filter(p => p.team_id === teamB?.id);

            const userTeam = currentUser?.team_id === teamA?.id ? 'team_a' : 'team_b';
            const isMyTurn = currentEvent.draft_team_turn === userTeam && currentUser?.is_admin;

            useEffect(() => {
                loadDraftPicks();
                loadEventData();
                loadDoublePlayRecords();
                
                // Subscribe to draft picks changes
                const picksChannel = supabaseClient
                    .channel('draft-picks-changes')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'draft_picks',
                        filter: `event_id=eq.${event.id}`
                    }, () => {
                        loadDraftPicks();
                    })
                    .subscribe();

                // Subscribe to event changes (for turn updates)
                const eventChannel = supabaseClient
                    .channel('event-updates')
                    .on('postgres_changes', {
                        event: '*',
                        schema: 'public',
                        table: 'events',
                        filter: `id=eq.${event.id}`
                    }, () => {
                        loadEventData();
                    })
                    .subscribe();

                return () => {
                    supabaseClient.removeChannel(picksChannel);
                    supabaseClient.removeChannel(eventChannel);
                };
            }, [event.id]);

            const loadEventData = async () => {
                const { data: updatedEvent } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('id', event.id)
                    .single();
                
                if (updatedEvent) {
                    setCurrentEvent(updatedEvent);
                    loadData();
                }
            };

            const loadDraftPicks = async () => {
                const { data } = await supabaseClient
                    .from('draft_picks')
                    .select('*')
                    .eq('event_id', event.id)
                    .order('pick_number');
                setDraftPicks(data || []);
                
                // Determine phase based on number of picks
                const singlesPicks = (data || []).filter(p => p.pick_type === 'single');
                const doublesPicks = (data || []).filter(p => p.pick_type === 'double');
                
                if (singlesPicks.length >= 12) {
                    // 6 singles matches = 12 picks, move to doubles
                    setDraftPhase('doubles');
                } else {
                    setDraftPhase('singles');
                }
                
                setLoading(false);
            };

            const loadDoublePlayRecords = async () => {
                const { data } = await supabaseClient
                    .from('player_double_plays')
                    .select('*');
                setDoublePlayRecords(data || []);
            };

            const makePick = async (playerId) => {
                if (!isMyTurn) {
                    console.log('Not your turn!');
                    return;
                }

                // Double-check in real-time before making pick
                const { data: freshEvent } = await supabaseClient
                    .from('events')
                    .select('*')
                    .eq('id', event.id)
                    .single();

                const freshUserTeam = currentUser?.team_id === teamA?.id ? 'team_a' : 'team_b';
                if (freshEvent.draft_team_turn !== freshUserTeam) {
                    console.log('Turn changed - not your turn anymore!');
                    setCurrentEvent(freshEvent);
                    return;
                }

                // Check if this player has already been picked twice in THIS event
                const timesPickedInThisEvent = draftPicks.filter(p => p.player_id === playerId).length;
                
                const player = players.find(p => p.id === playerId);
                const isTeamB = player && player.team_id === teamB?.id;
                
                // Team A (6 players) can NEVER be picked twice
                if (!isTeamB && timesPickedInThisEvent >= 1) {
                    alert('Team A players can only be picked once per event!');
                    return;
                }
                
                // Team B (5 players) - only ONE player can be picked twice per event
                if (isTeamB && timesPickedInThisEvent >= 2) {
                    alert('This player has already been picked twice in this event!');
                    return;
                }
                
                // If this would be the second pick for a Team B player
                if (isTeamB && timesPickedInThisEvent === 1) {
                    // Check if another Team B player has already been picked twice in THIS event
                    const teamBPlayerIds = teamBPlayers.map(p => p.id);
                    const playersPickedTwice = teamBPlayerIds.filter(pId => {
                        return draftPicks.filter(pick => pick.player_id === pId).length >= 2;
                    });
                    
                    if (playersPickedTwice.length > 0) {
                        const doublePlayer = players.find(p => p.id === playersPickedTwice[0]);
                        alert(`Only ONE player can play twice per event. ${doublePlayer.name} has already been picked twice.`);
                        return;
                    }
                    
                    // Check if they've already used their double-play TODAY in another event
                    const { data: todayDoubles } = await supabaseClient
                        .from('player_double_plays')
                        .select('*')
                        .eq('player_id', playerId);
                    
                    if (todayDoubles && todayDoubles.length > 0) {
                        alert(`${player.name} has already played twice in a previous event today. Choose a different player.`);
                        return;
                    }
                }

                const pickNumber = draftPicks.length;
                const team = freshEvent.draft_team_turn;

                await supabaseClient
                    .from('draft_picks')
                    .insert({
                        event_id: event.id,
                        pick_number: pickNumber,
                        team: team,
                        player_id: playerId,
                        pick_type: 'single'
                    });

                // If this is Team B player's second pick, record it in double_plays
                const timesNowPicked = draftPicks.filter(p => p.player_id === playerId).length + 1;
                if (isTeamB && timesNowPicked === 2) {
                    const { data: compData } = await supabaseClient
                        .from('competition')
                        .select('id')
                        .single();
                    
                    await supabaseClient
                        .from('player_double_plays')
                        .insert({
                            competition_id: compData.id,
                            player_id: playerId,
                            event_id: event.id
                        });
                }

                // Snake draft logic works the same regardless of who picks first
                // The pattern is always: First, Second, Second, First, First, Second, Second, First...
                // We just need to determine next team based on position in the pattern
                
                let nextTeam;
                const pickIndex = pickNumber; // 0-indexed
                
                // Determine the pattern position (0-3 repeating)
                const positionInGroup = pickIndex % 4;
                
                // The team that just picked
                const currentTeam = team;
                
                // Pattern logic:
                // Position 0: First team picks  ‚Üí Next: Second team
                // Position 1: Second team picks ‚Üí Stay: Second team  
                // Position 2: Second team picks ‚Üí Switch: First team
                // Position 3: First team picks  ‚Üí Stay: First team
                
                if (positionInGroup === 0) {
                    // Just made first pick, switch to other team
                    nextTeam = currentTeam === 'team_a' ? 'team_b' : 'team_a';
                } else if (positionInGroup === 1) {
                    // Just made pick 2 (second team's first), stay on same team
                    nextTeam = currentTeam;
                } else if (positionInGroup === 2) {
                    // Just made pick 3 (second team's second), switch teams
                    nextTeam = currentTeam === 'team_a' ? 'team_b' : 'team_a';
                } else {
                    // positionInGroup === 3
                    // Just made pick 4 (first team's second), stay on same team
                    nextTeam = currentTeam;
                }

                await supabaseClient
                    .from('events')
                    .update({
                        draft_team_turn: nextTeam,
                        current_draft_pick: pickNumber + 1
                    })
                    .eq('id', event.id);

                loadDraftPicks();
                loadEventData();
            };

            if (loading) {
                return <div style={{ textAlign: 'center', padding: '2rem' }}>Loading draft...</div>;
            }

            const singlesPicks = draftPicks.filter(p => p.pick_type === 'single');
            const doublesPicks = draftPicks.filter(p => p.pick_type === 'double');

            // Show different UI based on phase
            if (draftPhase === 'doubles') {
                console.log('Switching to doubles phase, event name:', event.name);
                // Computer Games is special - no doubles draft, just team events
                if (event.name === 'Computer Games') {
                    console.log('Rendering ComputerGamesTeamEvents');
                    return <ComputerGamesTeamEvents 
                        event={currentEvent}
                        singlesPicks={singlesPicks}
                        players={players}
                        teamA={teamA}
                        teamB={teamB}
                        currentUser={currentUser}
                        loadData={loadData}
                        setView={setView}
                    />;
                }
                
                console.log('Rendering DoublesPhase');
                return <DoublesPhase 
                    event={currentEvent}
                    teams={teams}
                    players={players}
                    currentUser={currentUser}
                    draftPicks={draftPicks}
                    singlesPicks={singlesPicks}
                    doublesPicks={doublesPicks}
                    teamA={teamA}
                    teamB={teamB}
                    userTeam={userTeam}
                    loadDraftPicks={loadDraftPicks}
                    loadEventData={loadEventData}
                    loadData={loadData}
                    setView={setView}
                />;
            }

            console.log('Rendering singles phase, picks:', singlesPicks.length);

            // Singles phase continues below...

            const pickedPlayerIds = draftPicks.map(p => p.player_id);
            const myTeamPlayers = userTeam === 'team_a' ? teamAPlayers : teamBPlayers;
            
            // For available players, check if they can still be picked
            const availablePlayers = myTeamPlayers.filter(p => {
                const timesPicked = draftPicks.filter(pick => pick.player_id === p.id).length;
                const isTeamB = p.team_id === teamB?.id;
                
                // Team A can only be picked once
                if (!isTeamB) {
                    return timesPicked === 0;
                }
                
                // Team B logic
                if (timesPicked >= 2) {
                    // Already picked twice, can't pick again
                    return false;
                }
                
                if (timesPicked === 1) {
                    // This would be their second pick
                    // Check if another Team B player has already been picked twice in THIS event
                    const teamBPlayerIds = teamBPlayers.map(tp => tp.id);
                    const playersPickedTwiceInThisEvent = teamBPlayerIds.filter(pId => {
                        return draftPicks.filter(pick => pick.player_id === pId).length >= 2;
                    });
                    
                    if (playersPickedTwiceInThisEvent.length > 0) {
                        // Another player already doubled in this event, can't double this one
                        return false;
                    }
                    
                    // Check if this player has already doubled in a PREVIOUS event today
                    const hasDoubledBefore = doublePlayRecords.some(record => record.player_id === p.id);
                    if (hasDoubledBefore) {
                        // This player already doubled in another event, can't pick twice again
                        return false;
                    }
                }
                
                return true;
            });

            return (
                <div>
                    <div style={{ 
                        marginBottom: '3rem',
                        padding: '2rem',
                        background: 'rgba(255, 255, 255, 0.05)',
                        borderRadius: '12px',
                        border: '2px solid rgba(255, 255, 255, 0.1)',
                    }}>
                        <h3 style={{ fontSize: '2rem', marginBottom: '1rem', color: '#ffd700', textAlign: 'center' }}>
                            SNAKE DRAFT
                        </h3>
                        
                        {isMyTurn ? (
                            <div style={{ textAlign: 'center', fontSize: '1.5rem', color: '#00ff00', letterSpacing: '2px' }}>
                                YOUR TURN - PICK A PLAYER
                            </div>
                        ) : (
                            <div style={{ textAlign: 'center', fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.5)', letterSpacing: '2px' }}>
                                WAITING FOR {currentEvent.draft_team_turn === 'team_a' ? 'TEAM A' : 'TEAM B'}
                            </div>
                        )}
                    </div>

                    {/* Player selection FIRST - so it's visible without scrolling */}
                    {isMyTurn && (
                        <div style={{ marginBottom: '3rem' }}>
                            <h4 style={{ fontSize: '1.5rem', marginBottom: '1rem', color: '#ffd700' }}>
                                Select Your Player:
                            </h4>
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(200px, 1fr))', gap: '1rem' }}>
                                {availablePlayers.map(player => {
                                    const timesPicked = draftPicks.filter(p => p.player_id === player.id).length;
                                    return (
                                        <button
                                            key={player.id}
                                            onClick={() => makePick(player.id)}
                                            style={{
                                                background: userTeam === 'team_a' 
                                                    ? 'linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(255, 107, 107, 0.2))'
                                                    : 'linear-gradient(135deg, rgba(78, 205, 196, 0.3), rgba(78, 205, 196, 0.2))',
                                                border: userTeam === 'team_a'
                                                    ? '2px solid rgba(255, 107, 107, 0.5)'
                                                    : '2px solid rgba(78, 205, 196, 0.5)',
                                                borderRadius: '12px',
                                                padding: '1.5rem',
                                                cursor: 'pointer',
                                                fontSize: '1.3rem',
                                                color: '#ffffff',
                                                fontFamily: 'inherit',
                                                letterSpacing: '2px',
                                                transition: 'all 0.3s',
                                                position: 'relative',
                                            }}
                                        >
                                            {player.name}
                                            {timesPicked === 1 && (
                                                <div style={{
                                                    position: 'absolute',
                                                    top: '0.5rem',
                                                    right: '0.5rem',
                                                    background: '#ffd700',
                                                    color: '#0f0c29',
                                                    borderRadius: '50%',
                                                    width: '24px',
                                                    height: '24px',
                                                    display: 'flex',
                                                    alignItems: 'center',
                                                    justifyContent: 'center',
                                                    fontSize: '0.9rem',
                                                    fontWeight: 'bold',
                                                }}>
                                                    1
                                                </div>
                                            )}
                                        </button>
                                    );
                                })}
                            </div>
                        </div>
                    )}

                    {/* Live Matchups Formation */}
                    <div style={{ marginBottom: '3rem' }}>
                        <h4 style={{ fontSize: '1.5rem', marginBottom: '1.5rem', color: 'rgba(255, 255, 255, 0.7)' }}>
                            Match-ups:
                        </h4>
                        <div style={{ display: 'flex', flexDirection: 'column', gap: '1rem' }}>
                            {[0, 1, 2, 3, 4, 5].map(matchIndex => {
                                // ABBAABBA pattern means:
                                // Match 0: pick 0 (A) vs pick 1 (B)
                                // Match 1: pick 2 (B) vs pick 3 (A)  
                                // Match 2: pick 4 (A) vs pick 5 (B)
                                // Match 3: pick 6 (B) vs pick 7 (A)
                                // Match 4: pick 8 (A) vs pick 9 (B)
                                // Match 5: pick 10 (B) vs pick 11 (A)
                                
                                const pickIndices = [
                                    [0, 1], // Match 0
                                    [2, 3], // Match 1
                                    [4, 5], // Match 2
                                    [6, 7], // Match 3
                                    [8, 9], // Match 4
                                    [10, 11] // Match 5
                                ];
                                
                                const [idx1, idx2] = pickIndices[matchIndex];
                                const pick1 = singlesPicks[idx1];
                                const pick2 = singlesPicks[idx2];
                                
                                const player1 = pick1 ? players.find(pl => pl.id === pick1.player_id) : null;
                                const player2 = pick2 ? players.find(pl => pl.id === pick2.player_id) : null;
                                
                                // Determine which is Team A and which is Team B
                                const teamAPlayer = pick1?.team === 'team_a' ? player1 : player2;
                                const teamBPlayer = pick1?.team === 'team_b' ? player1 : player2;
                                
                                return (
                                    <div key={matchIndex} style={{
                                        padding: '1.5rem',
                                        background: 'rgba(255, 255, 255, 0.05)',
                                        borderRadius: '12px',
                                        border: '2px solid rgba(255, 255, 255, 0.1)',
                                    }}>
                                        <div style={{ fontSize: '1rem', color: 'rgba(255, 255, 255, 0.5)', marginBottom: '1rem' }}>
                                            Match {matchIndex + 1}
                                        </div>
                                        <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '1.5rem', alignItems: 'center' }}>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamAPlayer ? 'rgba(255, 107, 107, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamAPlayer ? '2px solid rgba(255, 107, 107, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.3rem',
                                                color: teamAPlayer ? '#ff6b6b' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamAPlayer ? teamAPlayer.name : '???'}
                                            </div>
                                            <div style={{ fontSize: '1.5rem', color: 'rgba(255, 255, 255, 0.3)', fontWeight: 'bold' }}>
                                                VS
                                            </div>
                                            <div style={{
                                                padding: '1rem',
                                                background: teamBPlayer ? 'rgba(78, 205, 196, 0.2)' : 'rgba(255, 255, 255, 0.05)',
                                                border: teamBPlayer ? '2px solid rgba(78, 205, 196, 0.5)' : '2px dashed rgba(255, 255, 255, 0.2)',
                                                borderRadius: '8px',
                                                textAlign: 'center',
                                                fontSize: '1.3rem',
                                                color: teamBPlayer ? '#4ecdc4' : 'rgba(255, 255, 255, 0.3)',
                                            }}>
                                                {teamBPlayer ? teamBPlayer.name : '???'}
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<TeamCompetition />);
    </script>
</body>
</html>
